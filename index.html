<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Dog Money üê∂</title>
<style>
:root { --gold: linear-gradient(135deg,#ffcc00,#ff9f00);}
*{
    box-sizing:border-box;
    font-family:'Segoe UI',sans-serif;
    -webkit-tap-highlight-color: transparent;
    user-select: none;
    outline: none;
}
html,body{margin:0;padding:0;height:100%;background:radial-gradient(circle at top,#fff2d6,#ffd28a);overflow:hidden;}

header{text-align:center;padding:15px; position: relative; z-index: 100;}
.header-img{width:100%;max-width:300px;border-radius:22px;box-shadow:0 10px 25px rgba(0,0,0,0.2);}
.small{font-size:13px;opacity:0.7;margin-top:5px; color: #5d4037;}

/* –û–±–æ–ª–æ—á–∫–∞ –¥–ª—è —Å–ª–∞–π–¥–∏–Ω–≥–∞ —Å—Ç—Ä–∞–Ω–∏—Ü */
.viewport {
    position: relative;
    width: 100%;
    height: calc(100vh - 180px);
    perspective: 1000px;
    overflow: hidden;
}

.container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    padding: 15px;
    padding-bottom: 30px;
    overflow-y: auto;
    transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.5s;
    opacity: 0;
    pointer-events: none;
    visibility: hidden;
}

/* –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏ */
.container.active { opacity: 1; transform: translateX(0); pointer-events: auto; visibility: visible; }
.container.slide-left { transform: translateX(-100%); opacity: 0; }
.container.slide-right { transform: translateX(100%); opacity: 0; }

.card{
    background: rgba(255,255,255,0.9);
    backdrop-filter: blur(5px);
    border-radius: 22px;
    padding: 18px;
    margin-bottom: 16px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.08);
}

.btn{
    width:100%;
    padding:14px;
    border:none;
    border-radius:18px;
    font-size:16px;
    font-weight:700;
    cursor:pointer;
    background:var(--gold);
    box-shadow:0 6px 15px rgba(255,170,0,0.4);
    transition: transform 0.1s;
    color: #000;
}
.btn:active{transform:scale(0.95);}

nav{
    position:fixed;
    bottom:15px;
    left:15px;
    right:15px;
    height:68px;
    background:rgba(255,255,255,0.95);
    backdrop-filter:blur(20px);
    border-radius:25px;
    display:flex;
    padding:7px;
    z-index:999;
    box-shadow:0 15px 35px rgba(0,0,0,0.15);
}
nav button{
    flex:1;
    border:none;
    background:none;
    border-radius:18px;
    font-size:12px;
    font-weight:700;
    cursor:pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    color: #8d6e63;
}
nav button.active{
    background:var(--gold);
    color: #000;
    box-shadow: 0 5px 15px rgba(255,170,0,0.4);
    transform: translateY(-2px);
}

/* –≠—Ñ—Ñ–µ–∫—Ç –∫–æ—Å—Ç–æ—á–µ–∫ */
.bone{
    position:fixed;
    font-size:26px;
    pointer-events:none;
    z-index:9999;
    animation: explode 0.8s cubic-bezier(0.1, 0.8, 0.3, 1) forwards;
}
@keyframes explode {
    0% { opacity: 1; transform: translate(0,0) scale(1) rotate(0deg); }
    100% { opacity: 0; transform: translate(var(--x), var(--y)) scale(1.5) rotate(var(--r)); }
}

#overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.97);display:none;z-index:10000;color:#fff;padding:25px;overflow-y:auto;}
#overlay .closeBtn{position:absolute;top:20px;right:20px;background:var(--gold);color:#000;border:none;padding:12px 18px;border-radius:15px;font-weight:bold;}

#adminTable { width: 100%; border-collapse: collapse; margin-top: 20px; }
#adminTable td { padding: 12px 8px; border-bottom: 1px solid #333; }
#adminTable input { width: 60px; background: #222; color: #fff; border: 1px solid #444; border-radius: 5px; padding: 5px; }
</style>
<script src="https://www.gstatic.com/firebasejs/10.2.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.2.0/firebase-firestore.js"></script>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>

<header>
  <img class="header-img" src="https://i.postimg.cc/nrrTt15j/Giga-Chat-36.jpg" alt="Dog Money">
  <div class="small">–¢–≤–æ–π –ø—É—Ç—å –∫ –∑–æ–ª–æ—Ç—ã–º –∫–æ—Å—Ç–æ—á–∫–∞–º ü¶¥</div>
</header>

<div class="viewport" id="viewport">
  <div id="earn" class="container active">
    <div class="card">
      <h2>üêæ –ö–ª–∏–∫–µ—Ä</h2>
      <p>–ù–∞–∂–∏–º–∞–π –Ω–∞ –∫–Ω–æ–ø–∫—É –∏ —Å–æ–±–∏—Ä–∞–π –º–æ–Ω–µ—Ç—ã!</p>
      <button class="btn actionBtn" data-type="click">–ñ–ú–Ø–ö üêï</button>
      <h3 id="clicks">–ö–ª–∏–∫–æ–≤: 0</h3>
    </div>
    <div class="card">
      <h2>üìã –ó–∞–¥–∞–Ω–∏—è</h2>
      <button class="btn actionBtn" data-type="tasks">–û—Ç–∫—Ä—ã—Ç—å —Å–ø–∏—Å–æ–∫</button>
    </div>
  </div>

  <div id="profile" class="container slide-right">
    <div class="card" style="text-align:center;">
      <img src="" alt="üê∂" class="profile-photo" id="profilePhoto" style="width:80px; height:80px; border-radius:50%; border: 4px solid #ffcc00;">
      <h2 id="profileUsername">–ó–∞–≥—Ä—É–∑–∫–∞...</h2>
      <div style="text-align:left; margin-top:15px;">
        <p>üÜî ID: <span id="profileId">‚Äî</span></p>
        <p>üí∞ –ë–∞–ª–∞–Ω—Å: <b id="profileBalance" style="font-size:20px;">0 ü™ô</b></p>
      </div>
    </div>
  </div>

  <div id="info" class="container slide-right">
    <div class="card">
      <h2>üõ° –ê–¥–º–∏–Ω–∫–∞</h2>
      <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞–º–∏ (–¥–æ—Å—Ç—É–ø–Ω–æ –≤—Å–µ–º)</p>
      <button class="btn" id="openAdmin">–û—Ç–∫—Ä—ã—Ç—å –±–∞–∑—É</button>
    </div>
    <div class="card">
      <h2>üì¢ –ù–æ–≤–æ—Å—Ç–∏</h2>
      <button class="btn">–ù–∞—à –∫–∞–Ω–∞–ª</button>
    </div>
  </div>
</div>

<nav>
  <button id="btn-earn" class="active" onclick="navigate('earn')">üí∞ –ò–≥—Ä–∞—Ç—å</button>
  <button id="btn-profile" onclick="navigate('profile')">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button>
  <button id="btn-info" onclick="navigate('info')">‚ÑπÔ∏è –ò–Ω—Ñ–æ</button>
</nav>

<div id="overlay">
  <button class="closeBtn" onclick="document.getElementById('overlay').style.display='none'">‚úñ</button>
  <div id="overlayContent"></div>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.ready();
tg.expand();

// Firebase
const firebaseConfig = {
    apiKey: "AIzaSyDeY43dAjpJ2NxHneG4W66veHNBiQ5jhfA",
    authDomain: "dogsmoney.firebaseapp.com",
    projectId: "dogsmoney",
    storageBucket: "dogsmoney.firebasestorage.app",
    messagingSenderId: "339745413806",
    appId: "1:339745413806:web:08f8fdd856ee92a3002b3f"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let clicks = 0, balance = 0, userRef, userId = 0;
const pageOrder = ['earn', 'profile', 'info'];

// –õ–ò–°–¢–ê–ù–ò–ï –°–¢–†–ê–ù–ò–¶
function navigate(targetId) {
    const currentActive = document.querySelector('.container.active');
    const currentId = currentActive.id;
    if(currentId === targetId) return;

    const currentIndex = pageOrder.indexOf(currentId);
    const targetIndex = pageOrder.indexOf(targetId);

    pageOrder.forEach((id, index) => {
        const el = document.getElementById(id);
        const btn = document.getElementById('btn-' + id);
        
        el.classList.remove('active', 'slide-left', 'slide-right');
        btn.classList.remove('active');

        if (index === targetIndex) {
            el.classList.add('active');
            btn.classList.add('active');
        } else if (index < targetIndex) {
            el.classList.add('slide-left');
        } else {
            el.classList.add('slide-right');
        }
    });
    tg.HapticFeedback.impactOccurred("light");
}

// –í–ó–†–´–í –ö–û–°–¢–û–ß–ï–ö
function spawnBones(x, y) {
    for(let i=0; i<7; i++) {
        const bone = document.createElement("div");
        bone.className = "bone";
        bone.innerText = "ü¶¥";
        bone.style.left = x + "px";
        bone.style.top = y + "px";
        
        const vx = (Math.random() - 0.5) * 300;
        const vy = (Math.random() - 0.5) * 300 - 100;
        const vr = Math.random() * 500;
        
        bone.style.setProperty('--x', `${vx}px`);
        bone.style.setProperty('--y', `${vy}px`);
        bone.style.setProperty('--r', `${vr}deg`);
        
        document.body.appendChild(bone);
        setTimeout(() => bone.remove(), 800);
    }
}

document.addEventListener("mousedown", e => spawnBones(e.clientX, e.clientY));
document.addEventListener("touchstart", e => spawnBones(e.touches[0].clientX, e.touches[0].clientY));

// FIREBASE –õ–û–ì–ò–ö–ê
function initUser(user) {
    userId = user.id;
    document.getElementById("profileUsername").innerText = "@" + (user.username || "–ò–≥—Ä–æ–∫");
    document.getElementById("profileId").innerText = userId;
    if(user.photo_url) document.getElementById("profilePhoto").src = user.photo_url;

    userRef = db.collection("users").doc(String(userId));
    userRef.get().then(docSnap => {
        if(!docSnap.exists) {
            userRef.set({username: user.username || "User", balance: 0, clicks: 0});
        } else {
            const data = docSnap.data();
            clicks = data.clicks || 0;
            balance = data.balance || 0;
            document.getElementById("clicks").innerText = "–ö–ª–∏–∫–æ–≤: " + clicks;
            document.getElementById("profileBalance").innerText = balance + " ü™ô";
        }
    });
}

document.querySelectorAll(".actionBtn").forEach(btn=>{
    btn.onclick = (e) => {
        const type = btn.dataset.type;
        const overlay = document.getElementById("overlay");
        const content = document.getElementById("overlayContent");
        
        if(type === 'click') {
            overlay.style.display="block";
            content.innerHTML = `<h2 style="text-align:center;">–¢–ê–ü–ê–ô!</h2>
            <div id="tapArea" style="width:100%; height:200px; background:var(--gold); border-radius:30px; display:flex; align-items:center; justify-content:center; font-size:80px; box-shadow:0 10px 30px rgba(0,0,0,0.3);">üê∂</div>
            <h1 id="oc" style="text-align:center; font-size:60px;">${clicks}</h1>`;
            
            document.getElementById("tapArea").onclick = (ev) => {
                clicks++;
                document.getElementById("oc").innerText = clicks;
                document.getElementById("clicks").innerText = "–ö–ª–∏–∫–æ–≤: " + clicks;
                userRef.update({clicks: clicks});
                spawnBones(ev.clientX || ev.touches[0].clientX, ev.clientY || ev.touches[0].clientY);
                tg.HapticFeedback.impactOccurred("medium");
            };
        } else {
            tg.showAlert("–°–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ!");
        }
    }
});

// –ê–î–ú–ò–ù–ö–ê
document.getElementById("openAdmin").onclick = async () => {
    const overlay = document.getElementById("overlay");
    overlay.style.display="block";
    const content = document.getElementById("overlayContent");
    content.innerHTML = `<h2>üõ° –†–µ–¥–∞–∫—Ç–æ—Ä –±–∞–∑—ã</h2><table id="adminTable"></table>`;
    
    const snap = await db.collection("users").get();
    const table = document.getElementById("adminTable");
    snap.forEach(doc => {
        const data = doc.data();
        const row = table.insertRow();
        row.insertCell(0).innerText = data.username || "User";
        const input = document.createElement("input");
        input.type = "number";
        input.value = data.balance || 0;
        row.insertCell(1).appendChild(input);
        const save = document.createElement("button");
        save.innerText = "üÜó";
        save.style.padding = "5px 10px";
        save.onclick = () => {
            db.collection("users").doc(doc.id).update({balance: parseInt(input.value)});
            tg.showPopup({message: "–û–±–Ω–æ–≤–ª–µ–Ω–æ!"});
        };
        row.insertCell(2).appendChild(save);
    });
};

initUser(tg.initDataUnsafe?.user || {id: 7020322752, username: "AdminTest"});
</script>
</body>
</html>

