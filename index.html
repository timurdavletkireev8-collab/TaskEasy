<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Dog Money üê∂</title>
<style>
:root { --gold: linear-gradient(135deg,#ffcc00,#ff9f00); --bg: #ffd28a; }
*{
    box-sizing:border-box;
    font-family:'Segoe UI',sans-serif;
    -webkit-tap-highlight-color: transparent;
    user-select: none;
    outline: none;
}
html,body{margin:0;padding:0;height:100%;background: var(--bg); overflow:hidden;}

header{text-align:center;padding:15px; background: radial-gradient(circle at top,#fff2d6,#ffd28a); z-index: 100; position: relative;}
.header-img{width:100%;max-width:260px;border-radius:22px;box-shadow:0 8px 20px rgba(0,0,0,0.15);}
.small{font-size:13px;opacity:0.7;margin-top:5px; color: #5d4037; font-weight: 600;}

/* –ö–û–ù–¢–ï–ô–ù–ï–† –î–õ–Ø –õ–ò–°–¢–ê–ù–ò–Ø */
.viewport {
    position: relative;
    width: 100%;
    height: calc(100vh - 180px);
    overflow: hidden;
}

.page {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    padding: 15px;
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s;
    overflow-y: auto;
    background: var(--bg);
}

/* –°–æ—Å—Ç–æ—è–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü */
.page.active { transform: translateX(0); opacity: 1; z-index: 5; visibility: visible; }
.page.left { transform: translateX(-100%); opacity: 0; z-index: 1; visibility: hidden; }
.page.right { transform: translateX(100%); opacity: 0; z-index: 1; visibility: hidden; }

.card {
    background: #fff;
    border-radius: 22px;
    padding: 20px;
    margin-bottom: 16px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.06);
}

.btn {
    width: 100%;
    padding: 15px;
    border: none;
    border-radius: 18px;
    font-size: 16px;
    font-weight: 800;
    background: var(--gold);
    color: #000;
    cursor: pointer;
    box-shadow: 0 6px 15px rgba(255,170,0,0.4);
}
.btn:active { transform: scale(0.96); }

nav {
    position: fixed;
    bottom: 15px;
    left: 15px;
    right: 15px;
    height: 70px;
    background: rgba(255,255,255,0.9);
    backdrop-filter: blur(10px);
    border-radius: 25px;
    display: flex;
    padding: 6px;
    z-index: 1000;
    box-shadow: 0 10px 30px rgba(0,0,0,0.15);
}
nav button {
    flex: 1;
    border: none;
    background: none;
    border-radius: 18px;
    font-size: 13px;
    font-weight: 700;
    color: #8d6e63;
    transition: 0.3s;
}
nav button.active {
    background: var(--gold);
    color: #000;
}

/* –ö–û–°–¢–û–ß–ö–ò */
.bone {
    position: fixed;
    font-size: 28px;
    pointer-events: none;
    z-index: 9999;
    animation: boneFly 0.8s ease-out forwards;
}
@keyframes boneFly {
    0% { opacity: 1; transform: translate(0,0) scale(1); }
    100% { opacity: 0; transform: translate(var(--x), var(--y)) rotate(var(--r)) scale(1.6); }
}

#overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.95);
    display: none;
    z-index: 10000;
    color: #fff;
    padding: 25px;
    overflow-y: auto;
}
.closeBtn {
    background: var(--gold);
    border: none;
    padding: 12px 20px;
    border-radius: 15px;
    font-weight: bold;
    margin-bottom: 20px;
    float: right;
}

#adminTable { width: 100%; border-collapse: collapse; color: #fff; }
#adminTable td { padding: 10px; border-bottom: 1px solid #333; }
#adminTable input { width: 60px; background: #222; color: #fff; border: 1px solid #444; border-radius: 5px; padding: 5px; }
</style>

<script src="https://www.gstatic.com/firebasejs/10.2.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.2.0/firebase-firestore.js"></script>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>

<header>
    <img class="header-img" src="https://i.postimg.cc/nrrTt15j/Giga-Chat-36.jpg">
    <div class="small">–õ–ò–°–¢–ê–ô –ò –ó–ê–†–ê–ë–ê–¢–´–í–ê–ô ü¶¥</div>
</header>

<div class="viewport">
    <div id="p-earn" class="page active">
        <div class="card">
            <h2>üêæ –ö–ª–∏–∫–µ—Ä</h2>
            <p>–ù–∞–∂–∏–º–∞–π –∏ —Å–æ–±–∏—Ä–∞–π –Ω–∞–≥—Ä–∞–¥—ã!</p>
            <button class="btn" onclick="openClicker()">–û–¢–ö–†–´–¢–¨ –ö–õ–ò–ö–ï–† üêï</button>
            <h3 id="cDisp">–ö–ª–∏–∫–æ–≤: 0</h3>
        </div>
        <div class="card">
            <h2>üìã –ó–∞–¥–∞–Ω–∏—è</h2>
            <button class="btn" onclick="tg.showAlert('–†–∞–∑–¥–µ–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')">–°–ü–ò–°–û–ö –ó–ê–î–ê–ù–ò–ô</button>
        </div>
    </div>

    <div id="p-profile" class="page right">
        <div class="card" style="text-align:center;">
            <h2 id="userName">@user</h2>
            <p>ID: <span id="userIdDisp">0</span></p>
            <p style="font-size:20px;">–ë–∞–ª–∞–Ω—Å: <b id="userBal">0</b> ü™ô</p>
        </div>
        <div class="card">
            <h3>ü§ù –†–µ—Ñ–µ—Ä–∞–ª—ã</h3>
            <button class="btn" onclick="tg.showAlert('–ü—Ä–∏–≥–ª–∞—à–∞–π –¥—Ä—É–∑–µ–π!')">–ü–û–ó–í–ê–¢–¨ –î–†–£–ì–ê</button>
        </div>
    </div>

    <div id="p-info" class="page right">
        <div class="card">
            <h2>üõ° –ê–¥–º–∏–Ω–∫–∞</h2>
            <p>–î–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>
            <button class="btn" onclick="openAdmin()">–ë–ê–ó–ê –î–ê–ù–ù–´–•</button>
        </div>
        <div class="card">
            <h2>üì¢ –ù–∞—à –ö–∞–Ω–∞–ª</h2>
            <button class="btn">–ü–û–î–ü–ò–°–ê–¢–¨–°–Ø</button>
        </div>
    </div>
</div>

<nav>
    <button id="n-earn" class="active" onclick="showPage('earn')">üí∞ –ò–≥—Ä–∞—Ç—å</button>
    <button id="n-profile" onclick="showPage('profile')">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button>
    <button id="n-info" onclick="showPage('info')">‚ÑπÔ∏è –ò–Ω—Ñ–æ</button>
</nav>

<div id="overlay">
    <button class="closeBtn" onclick="document.getElementById('overlay').style.display='none'">–ó–ê–ö–†–´–¢–¨</button>
    <div id="ovContent" style="clear:both;"></div>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.ready();

const firebaseConfig = {
    apiKey: "AIzaSyDeY43dAjpJ2NxHneG4W66veHNBiQ5jhfA",
    authDomain: "dogsmoney.firebaseapp.com",
    projectId: "dogsmoney",
    storageBucket: "dogsmoney.firebasestorage.app",
    messagingSenderId: "339745413806",
    appId: "1:339745413806:web:08f8fdd856ee92a3002b3f"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let clicks = 0, balance = 0, userRef, userId = 0;
const pages = ['earn', 'profile', 'info'];

// –õ–ò–°–¢–ê–ù–ò–ï
function showPage(target) {
    const targetIdx = pages.indexOf(target);
    
    pages.forEach((p, idx) => {
        const el = document.getElementById('p-' + p);
        const btn = document.getElementById('n-' + p);
        el.classList.remove('active', 'left', 'right');
        btn.classList.remove('active');

        if(idx === targetIdx) {
            el.classList.add('active');
            btn.classList.add('active');
        } else if(idx < targetIdx) {
            el.classList.add('left');
        } else {
            el.classList.add('right');
        }
    });
    tg.HapticFeedback.impactOccurred("light");
}

// –ö–û–°–¢–û–ß–ö–ò
function doBurst(x, y) {
    for(let i=0; i<6; i++) {
        const b = document.createElement("div");
        b.className = "bone"; b.innerText = "ü¶¥";
        b.style.left = x + "px"; b.style.top = y + "px";
        const vx = (Math.random() - 0.5) * 300;
        const vy = (Math.random() - 0.5) * 300 - 100;
        const vr = Math.random() * 360;
        b.style.setProperty('--x', vx + "px");
        b.style.setProperty('--y', vy + "px");
        b.style.setProperty('--r', vr + "deg");
        document.body.appendChild(b);
        setTimeout(() => b.remove(), 800);
    }
}
document.addEventListener("mousedown", e => doBurst(e.clientX, e.clientY));
document.addEventListener("touchstart", e => doBurst(e.touches[0].clientX, e.touches[0].clientY));

// FIREBASE
function init() {
    const u = tg.initDataUnsafe?.user || {id: 7020322752, username: "Player"};
    userId = u.id;
    document.getElementById("userName").innerText = "@" + (u.username || "User");
    document.getElementById("userIdDisp").innerText = userId;
    
    userRef = db.collection("users").doc(String(userId));
    userRef.get().then(doc => {
        if(!doc.exists) userRef.set({username: u.username || "User", balance: 0, clicks: 0});
        else {
            const data = doc.data();
            clicks = data.clicks || 0; balance = data.balance || 0;
            document.getElementById("cDisp").innerText = "–ö–ª–∏–∫–æ–≤: " + clicks;
            document.getElementById("userBal").innerText = balance;
        }
    });
}

function openClicker() {
    const ov = document.getElementById("overlay");
    const cnt = document.getElementById("ovContent");
    ov.style.display = "block";
    cnt.innerHTML = `<div id="target" style="width:220px; height:220px; background:var(--gold); border-radius:50%; margin: 60px auto; display:flex; align-items:center; justify-content:center; font-size:100px; box-shadow:0 0 40px rgba(255,170,0,0.6)">üê∂</div><h1 id="tapCount" style="text-align:center; font-size:50px;">${clicks}</h1>`;
    
    document.getElementById("target").onclick = (e) => {
        clicks++;
        document.getElementById("tapCount").innerText = clicks;
        document.getElementById("cDisp").innerText = "–ö–ª–∏–∫–æ–≤: " + clicks;
        userRef.update({clicks});
        doBurst(e.clientX || e.touches[0].clientX, e.clientY || e.touches[0].clientY);
        tg.HapticFeedback.impactOccurred("medium");
    };
}

async function openAdmin() {
    const ov = document.getElementById("overlay");
    const cnt = document.getElementById("ovContent");
    ov.style.display = "block";
    cnt.innerHTML = `<h2>üõ° –ë–∞–∑–∞ –ò–≥—Ä–æ–∫–æ–≤</h2><table id="adminTable"></table>`;
    const snap = await db.collection("users").get();
    snap.forEach(doc => {
        const d = doc.data();
        const row = document.getElementById("adminTable").insertRow();
        row.insertCell(0).innerText = d.username || "???";
        const inp = document.createElement("input"); inp.type="number"; inp.value = d.balance || 0;
        row.insertCell(1).appendChild(inp);
        const save = document.createElement("button"); save.innerText = "–û–ö";
        save.onclick = () => {
            db.collection("users").doc(doc.id).update({balance: parseInt(inp.value)});
            tg.showPopup({message: "–ì–æ—Ç–æ–≤–æ!"});
        };
        row.insertCell(2).appendChild(save);
    });
}

init();
</script>
</body>
</html>
