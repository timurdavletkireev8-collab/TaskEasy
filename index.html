<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EASY MONEY</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
import { getDatabase, ref, set, get, update, onValue, push } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyApcL3hN95djDhI-26L623jHHbzREswfQE",
  authDomain: "cash-1968a.firebaseapp.com",
  databaseURL: "https://cash-1968a-default-rtdb.firebaseio.com",
  projectId: "cash-1968a",
  storageBucket: "cash-1968a.appspot.com",
  messagingSenderId: "234016139024",
  appId: "1:234016139024:web:f11daa0328ff06173d2795"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const tg = window.Telegram.WebApp;
tg.expand();

const ADMIN_ID = 7020322752;
const user = tg.initDataUnsafe?.user;
const uid = user?.id || 0;

const userRef = ref(db, "users/" + uid);

let balance = 0;
let energy = 1000;
let reports = [];

if (uid) {
  get(userRef).then(s => {
    if (!s.exists()) {
      set(userRef, {
        balance: 0,
        energy: 1000,
        refBy: tg.initDataUnsafe?.start_param || null
      });
    }
  });
}

onValue(userRef, s => {
  const d = s.val();
  if (!d) return;
  balance = d.balance || 0;
  energy = d.energy || 1000;
  document.getElementById("balance").innerText = balance.toFixed(2);
  document.getElementById("energy").innerText = energy;
});

onValue(ref(db, "reports"), s => {
  reports = [];
  s.forEach(c => {
    if (c.val().uid === uid) reports.push(c.val());
  });
});

window.showPage = id => {
  document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
  document.getElementById(id).classList.add("active");
};

window.nav = id => {
  document.querySelectorAll(".nav img").forEach(i => i.classList.remove("active"));
  showPage(id);
  event.target.classList.add("active");
};

window.tap = () => {
  if (energy <= 0) return;
  energy--;
  balance += 0.005;
  update(userRef, { balance, energy });
};

window.copyRef = () => {
  navigator.clipboard.writeText("https://t.me/DifferentEarningsBot?start=" + uid);
  alert("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞");
};

window.sendWithdraw = () => {
  const card = cardInput.value;
  const sum = +sumWithdraw.value;
  if (sum < 100 || sum > balance) return alert("–û—à–∏–±–∫–∞ —Å—É–º–º—ã");
  update(userRef, { balance: balance - sum });
  push(ref(db, "withdrawals"), { uid, card, sum, status: "pending" });
  alert("–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞");
};

window.renderHistory = type => {
  const box = document.getElementById("historyList");
  box.innerHTML = "";
  reports.filter(r => r.status === type).forEach(r => {
    const d = document.createElement("div");
    d.className = "card";
    d.innerText = `${r.taskName} ‚Äî ${r.price}‚ÇΩ`;
    box.appendChild(d);
  });
};

if (user?.photo_url) {
  document.getElementById("profilePic").src = user.photo_url;
}

document.getElementById("uid").innerText = uid;

</script>

<style>
*{box-sizing:border-box}
html,body{margin:0;height:100%;font-family:Arial;color:white}
body{background:url("https://i.postimg.cc/2jx4fT8X/Giga-Chat-40.jpg") center/cover no-repeat}
.top{display:flex;justify-content:space-between;padding:16px 20px}
.title{font-size:22px;font-weight:900;padding:8px 14px;background:rgba(255,255,255,.12);border:2px solid rgba(255,255,255,.8);border-radius:16px}
.balance{padding:10px 14px;background:rgba(0,0,0,.55);border:2px solid rgba(255,255,255,.8);border-radius:16px}
.page{display:none;padding:20px;height:calc(100% - 150px);overflow:auto}
.page.active{display:block}
.card{background:rgba(0,0,0,.45);border:2px solid rgba(255,255,255,.8);border-radius:22px;padding:20px;margin-bottom:20px}
.btn{width:100%;padding:16px;margin-top:14px;font-size:16px;background:rgba(0,0,0,.5);border:2px solid rgba(255,255,255,.8);border-radius:18px;color:white}
.btn-red{background:rgba(255,0,0,.35)}
.nav{position:fixed;bottom:0;width:100%;height:90px;background:rgba(0,0,0,.6);display:flex;justify-content:space-around;align-items:center}
.nav img{width:48px;height:48px;opacity:.6}
.nav img.active{opacity:1}
.click-img{width:200px;height:200px;margin:30px auto;display:block;border-radius:24px;border:3px solid white}
</style>

</head>
<body>

<div class="top">
  <div class="title">EASY MONEY</div>
  <div class="balance" onclick="showPage('withdraw')">–ë–∞–ª–∞–Ω—Å: <span id="balance">0</span>‚ÇΩ</div>
</div>

<div id="earn" class="page active">
  <div class="card">
    <button class="btn" onclick="showPage('referral')">–†–µ—Ñ–µ—Ä–∞–ª—ã</button>
    <button class="btn" onclick="showPage('tasks')">–ó–∞–¥–∞–Ω–∏—è</button>
    <button class="btn" onclick="showPage('click')">–ö–ª–∏–∫–∏</button>
  </div>
</div>

<div id="referral" class="page">
  <div class="card">
    <p>+10‚ÇΩ –∏ 200 —ç–Ω–µ—Ä–≥–∏–∏</p>
    <button class="btn" onclick="copyRef()">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
    <button class="btn btn-red" onclick="showPage('earn')">–ù–∞–∑–∞–¥</button>
  </div>
</div>

<div id="click" class="page">
  <div class="card">
    <p>–≠–Ω–µ—Ä–≥–∏—è: <span id="energy">1000</span>/1000</p>
    <img class="click-img" src="https://i.postimg.cc/cCspvTn2/Picsart-26-01-03-04-33-45-909.png" onclick="tap()">
  </div>
</div>

<div id="profile" class="page">
  <div class="card">
    <img id="profilePic" style="width:60px;border-radius:50%">
    <p>ID: <span id="uid"></span></p>
    <button class="btn" onclick="renderHistory('approved');showPage('history')">–ò—Å—Ç–æ—Ä–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π</button>
    <button class="btn" onclick="renderHistory('pending');showPage('history')">–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</button>
    <button class="btn" onclick="renderHistory('rejected');showPage('history')">–û—Ç–∫–ª–æ–Ω—ë–Ω–Ω—ã–µ</button>
    <button class="btn btn-red" onclick="showPage('withdraw')">–í—ã–≤–æ–¥</button>
  </div>
</div>

<div id="history" class="page">
  <div id="historyList"></div>
  <button class="btn btn-red" onclick="showPage('profile')">–ù–∞–∑–∞–¥</button>
</div>

<div id="withdraw" class="page">
  <div class="card">
    <input id="cardInput" placeholder="–ö–∞—Ä—Ç–∞">
    <input id="sumWithdraw" type="number" placeholder="–°—É–º–º–∞ –æ—Ç 100‚ÇΩ">
    <button class="btn" onclick="sendWithdraw()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
  </div>
</div>

<div id="info" class="page">
  <div class="card">
    <pre style="white-space:pre-wrap">
üìë –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è EASY MONEY
(—Ç–≤–æ–π —Ç–µ–∫—Å—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ—Ö—Ä–∞–Ω—ë–Ω)
    </pre>
  </div>
</div>

<div class="nav">
  <img src="https://i.postimg.cc/9MfvXtnQ/Picsart-26-01-03-07-41-15-897.png" onclick="nav('earn')" class="active">
  <img src="https://i.postimg.cc/jdGK89kw/Picsart-26-01-03-07-38-38-882.png" onclick="nav('profile')">
  <img src="https://i.postimg.cc/9fBhQfXL/Picsart-26-01-03-07-38-01-962.png" onclick="nav('info')">
</div>

</body>
</html>
