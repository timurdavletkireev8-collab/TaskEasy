<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EASY MONEY</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
  import { getDatabase, ref, set, get, onValue, update, push } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyApcL3hN95djDhI-26L623jHHbzREswfQE",
    authDomain: "cash-1968a.firebaseapp.com",
    databaseURL: "https://cash-1968a-default-rtdb.firebaseio.com",
    projectId: "cash-1968a",
    storageBucket: "cash-1968a.appspot.com",
    messagingSenderId: "234016139024",
    appId: "1:234016139024:web:f11daa0328ff06173d2795"
  };
  const app = initializeApp(firebaseConfig);
  window.db = getDatabase(app);

  const tg = window.Telegram.WebApp;
  tg.expand();
  window.tg = tg;

  let uid = tg.initDataUnsafe?.user?.id || 0;
  let balance = 0;
  let energy = 1000;
  let userReports = {}; 
  const adminID = 7020322752;

  const userRef = ref(window.db, "users/" + uid);

  // –°–∫—Ä—ã—Ç–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏
  setTimeout(() => { document.getElementById("loader").style.display = "none"; }, 2500);

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≠–Ω–µ—Ä–≥–∏–∏ (—Ä–∞–∑ –≤ 24 —á–∞—Å–∞)
  get(userRef).then(snapshot => {
    const now = Date.now();
    if(snapshot.exists()){
      const data = snapshot.val();
      const lastReset = data.lastEnergyReset || 0;
      if(now - lastReset > 86400000) { // 24 —á–∞—Å–∞ –≤ –º—Å
        update(userRef, { energy: 1000, lastEnergyReset: now });
      }
    } else {
      set(userRef, {balance:0, energy:1000, lastEnergyReset: now, uid: uid});
    }
  });

  // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  onValue(userRef, snapshot => {
    const data = snapshot.val();
    if(data){
      balance = data.balance || 0;
      energy = data.energy || 0;
      document.getElementById("balance").innerText = balance.toFixed(2);
      document.getElementById("energy").innerText = energy;
      document.getElementById("uid_val").innerText = uid;
      
      const photo = tg.initDataUnsafe?.user?.photo_url;
      if(photo) document.getElementById("profilePic").src = photo;
      
      const img = document.querySelector(".click-img");
      if(energy <= 0) { img.style.opacity = "0.4"; img.style.filter = "grayscale(1)"; }
      else { img.style.opacity = "1"; img.style.filter = "none"; }
    }
  });

  // –ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç—á–µ—Ç–æ–≤ (–¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏ –∏—Å—Ç–æ—Ä–∏–∏)
  onValue(ref(window.db, "reports"), s => {
    userReports = {};
    const hEarned = document.getElementById("hist-earned");
    const hDone = document.getElementById("hist-done");
    const hBad = document.getElementById("hist-bad");
    hEarned.innerHTML = ""; hDone.innerHTML = ""; hBad.innerHTML = "";

    if(s.exists()){
      s.forEach(child => {
        const r = child.val();
        if(r.uid === uid) {
          userReports[r.taskId] = r.status;
          const cardHtml = `<div class="card" style="margin-bottom:8px; padding:10px; font-size:14px;"><b>${r.taskName}</b><br>${r.price}‚ÇΩ</div>`;
          if(r.status === "approved") { hEarned.innerHTML += cardHtml; hDone.innerHTML += cardHtml; }
          if(r.status === "rejected") { hBad.innerHTML += cardHtml; }
        }
      });
    }
  });

  // –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞–Ω–∏–π
  onValue(ref(window.db, "tasks"), s => {
    const list = document.getElementById("task-list");
    list.innerHTML = "";
    if(s.exists()){
      s.forEach(child => {
        const t = child.val();
        const div = document.createElement("div");
        div.className = "card";
        div.style.cursor = "pointer";
        const status = userReports[child.key] || "";
        const icon = status === "pending" ? "‚è≥" : (status === "approved" ? "‚úÖ" : "");
        div.innerHTML = `<strong>${t.name} ${icon}</strong> <span style="float:right">${t.price}‚ÇΩ</span>`;
        div.onclick = () => openTaskDetails(child.key, t);
        list.appendChild(div);
      });
    }
  });

  // –ê–¥–º–∏–Ω–∫–∞
  if(uid === adminID) {
    onValue(ref(window.db, "reports"), s => {
      const cont = document.getElementById("admin-reports-list");
      cont.innerHTML = "";
      s.forEach(c => {
        const r = c.val();
        if(r.status === "pending") {
          const d = document.createElement("div");
          d.className = "card";
          d.innerHTML = `ID: ${r.uid}<br>–ó–∞–¥–∞–Ω–∏–µ: ${r.taskName}<br>–û—Ç—á–µ—Ç: ${r.info}<br>
            <button class="btn" style="background:green" onclick="approveReport('${c.key}')">–û–¥–æ–±—Ä–∏—Ç—å</button>
            <button class="btn btn-red" onclick="rejectReport('${c.key}')">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>`;
          cont.appendChild(d);
        }
      });
    });

    onValue(ref(window.db, "logs"), s => {
        const cont = document.getElementById("admin-logs-list");
        cont.innerHTML = "";
        let logsArr = [];
        s.forEach(c => logsArr.push(c.val()));
        logsArr.reverse().slice(0, 50).forEach(l => {
            const line = document.createElement("div");
            line.style.fontSize = "11px"; line.style.borderBottom = "1px solid #444";
            line.innerText = `[${l.time}] ID${l.uid}: ${l.msg}`;
            cont.appendChild(line);
        });
    });
  }

  // –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
  window.tap = function(){
    if(energy <= 0) return;
    energy--;
    balance += 0.005;
    update(userRef, {balance, energy});
  };

  window.showPage = function(id){
    document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
    document.getElementById(id).classList.add("active");
  };

  window.nav = function(id, event){
    document.querySelectorAll(".nav img").forEach(i=>i.classList.remove("active"));
    showPage(id);
    if(event) event.target.classList.add("active");
  };

  window.openTaskDetails = function(id, task) {
    document.getElementById("det-title").innerText = task.name;
    document.getElementById("det-desc").innerText = task.desc;
    document.getElementById("det-price").innerText = task.price;
    document.getElementById("det-link-btn").onclick = () => window.tg.openLink(task.link);
    const sendBtn = document.getElementById("det-send-btn");
    const st = userReports[id];
    if(st === "pending" || st === "approved") {
        sendBtn.disabled = true; sendBtn.style.opacity = "0.5";
        sendBtn.innerText = st === "pending" ? "–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ..." : "–í—ã–ø–æ–ª–Ω–µ–Ω–æ ‚úÖ";
    } else {
        sendBtn.disabled = false; sendBtn.style.opacity = "1";
        sendBtn.innerText = "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç";
        sendBtn.onclick = () => sendTaskReport(id, task);
    }
    showPage('task-details');
  };

  window.sendTaskReport = function(taskId, task) {
    const info = document.getElementById("det-input").value;
    if(!info) return alert("–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—á–µ—Ç–∞!");
    push(ref(window.db, "reports"), {uid, taskId, taskName: task.name, info, price: task.price, status: "pending"});
    logAction(`–û—Ç–ø—Ä–∞–≤–∏–ª –æ—Ç—á–µ—Ç –ø–æ –∑–∞–¥–∞–Ω–∏—é: ${task.name}`);
    alert("–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É!");
    showPage('tasks');
  };

  window.approveReport = function(id) {
    get(ref(window.db, `reports/${id}`)).then(s => {
        const r = s.val();
        const uR = ref(window.db, `users/${r.uid}`);
        get(uR).then(us => {
            const currentBal = us.val().balance || 0;
            update(uR, {balance: currentBal + r.price});
            update(ref(window.db, `reports/${id}`), {status: "approved"});
            logAction(`–ê–î–ú–ò–ù –û–î–û–ë–†–ò–õ –∑–∞–¥–∞–Ω–∏–µ —é–∑–µ—Ä–∞ ${r.uid} (+${r.price}‚ÇΩ)`, true);
        });
    });
  };

  window.rejectReport = function(id) {
    get(ref(window.db, `reports/${id}`)).then(s => {
        const r = s.val();
        update(ref(window.db, `reports/${id}`), {status: "rejected"});
        logAction(`–ê–î–ú–ò–ù –û–¢–ö–õ–û–ù–ò–õ –∑–∞–¥–∞–Ω–∏–µ —é–∑–µ—Ä–∞ ${r.uid}`, true);
    });
  };

  window.logAction = function(msg, isAdmin=false) {
    push(ref(window.db, "logs"), {uid, msg, time: new Date().toLocaleString(), isAdmin});
  };

</script>

<style>
*{box-sizing:border-box}
body{margin:0;height:100vh;font-family:Arial,sans-serif;color:white;background:url("https://i.postimg.cc/2jx4fT8X/Giga-Chat-40.jpg") center/cover no-repeat;overflow:hidden;}

/* LOADER */
#loader{position:fixed;top:0;left:0;width:100%;height:100%;background:#111;display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:9999;}
.loader-logo{width:110px;animation:pulse 1.5s infinite;}
@keyframes pulse{0%{transform:scale(1)} 50%{transform:scale(1.1)} 100%{transform:scale(1)}}

.top{display:flex;justify-content:space-between;align-items:center;padding:15px 20px;}
.title{font-size:20px;font-weight:900;padding:8px 14px;background:rgba(255,255,255,0.12);border:2px solid white;border-radius:14px;backdrop-filter:blur(5px);}
.balance{padding:10px 14px;background:rgba(0,0,0,0.5);border:2px solid white;border-radius:14px;}

.page{display:none;padding:20px;height:calc(100vh - 160px);overflow-y:auto;}
.active{display:block}
.card{background:rgba(0,0,0,0.5);border:2px solid rgba(255,255,255,0.7);border-radius:20px;padding:18px;margin-bottom:15px;}
.btn{width:100%;padding:15px;margin-top:10px;font-weight:bold;color:white;background:rgba(0,0,0,0.4);border:2px solid white;border-radius:15px;cursor:pointer;}
.btn-red{background:rgba(255,0,0,0.25); border-color: rgba(255,255,255,0.5);}

.nav{position:fixed;bottom:0;width:100%;height:85px;background:rgba(0,0,0,0.7);display:flex;justify-content:space-around;align-items:center;}
.nav img{width:42px;opacity:0.6;}
.nav img.active{opacity:1;}

.click-img{width:190px;margin:25px auto;display:block;border-radius:22px;border:3px solid white; transition: 0.2s;}
input, textarea{width:100%;padding:12px;margin-top:10px;border-radius:12px;border:1px solid white;background:rgba(0,0,0,0.25);color:white;}
.profile-pic{width:85px;height:85px;border-radius:50%;border:3px solid white;margin-bottom:10px;object-fit:cover;}
</style>
</head>
<body>

<div id="loader">
    <img class="loader-logo" src="https://i.postimg.cc/cCspvTn2/Picsart-26-01-03-04-33-45-909.png">
    <h2 style="letter-spacing:3px;">–ó–ê–ì–†–£–ó–ö–ê</h2>
</div>

<div class="top">
  <div class="title">EASY MONEY</div>
  <div class="balance" onclick="showPage('withdraw')"><span id="balance">0.00</span>‚ÇΩ</div>
</div>

<div id="earn" class="page active">
  <div class="card">
    <button class="btn" onclick="showPage('referral')">üë´ –î—Ä—É–∑—å—è –∏ –†–µ—Ñ–µ—Ä–∞–ª—ã</button>
    <button class="btn" onclick="showPage('tasks')">üìã –°–ø–∏—Å–æ–∫ –ó–∞–¥–∞–Ω–∏–π</button>
    <button class="btn" onclick="showPage('click')">üñ±Ô∏è –ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ –∫–ª–∏–∫–∞—Ö</button>
  </div>
</div>

<div id="click" class="page">
  <div class="card" style="text-align:center">
    <p>–≠–Ω–µ—Ä–≥–∏—è: <span id="energy">1000</span>/1000</p>
    <img class="click-img" src="https://i.postimg.cc/cCspvTn2/Picsart-26-01-03-04-33-45-909.png" onclick="tap()">
    <button class="btn btn-red" onclick="showPage('earn')">–ù–∞–∑–∞–¥</button>
  </div>
</div>

<div id="tasks" class="page">
  <h3>–î–æ—Å—Ç—É–ø–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è</h3>
  <div id="task-list"></div>
  <button class="btn btn-red" onclick="showPage('earn')">–ù–∞–∑–∞–¥</button>
</div>

<div id="task-details" class="page">
  <div class="card">
    <h3 id="det-title"></h3>
    <p id="det-desc"></p>
    <p>–ù–∞–≥—Ä–∞–¥–∞: <span id="det-price"></span>‚ÇΩ</p>
    <button class="btn" id="det-link-btn" style="background:#0088cc">–ü–µ—Ä–µ–π—Ç–∏ –ø–æ —Å—Å—ã–ª–∫–µ</button>
    <textarea id="det-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ç—á–µ—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∏–∫–Ω–µ–π–º)..."></textarea>
    <button class="btn" id="det-send-btn" style="background:#28a745">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç</button>
    <button class="btn btn-red" onclick="showPage('tasks')">–û—Ç–º–µ–Ω–∞</button>
  </div>
</div>

<div id="profile" class="page">
  <div class="card" style="text-align:center">
    <img id="profilePic" class="profile-pic" src="https://i.postimg.cc/cCspvTn2/Picsart-26-01-03-04-33-45-909.png">
    <p>–í–∞—à ID: <span id="uid_val"></span></p>
    <button class="btn" onclick="showPage('h-1')">üí∞ –ò—Å—Ç–æ—Ä–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π</button>
    <button class="btn" onclick="showPage('h-2')">‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è</button>
    <button class="btn" onclick="showPage('h-3')">‚ùå –û—Ç–∫–ª–æ–Ω—ë–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è</button>
    <button class="btn btn-red" onclick="showPage('withdraw')" style="margin-top:20px;">–í—ã–≤–µ—Å—Ç–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞</button>
  </div>
</div>

<div id="h-1" class="page"><h3>–ù–∞—á–∏—Å–ª–µ–Ω–∏—è</h3><div id="hist-earned"></div><button class="btn btn-red" onclick="showPage('profile')">–ù–∞–∑–∞–¥</button></div>
<div id="h-2" class="page"><h3>–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ</h3><div id="hist-done"></div><button class="btn btn-red" onclick="showPage('profile')">–ù–∞–∑–∞–¥</button></div>
<div id="h-3" class="page"><h3>–û—Ç–∫–ª–æ–Ω—ë–Ω–Ω—ã–µ</h3><div id="hist-bad"></div><button class="btn btn-red" onclick="showPage('profile')">–ù–∞–∑–∞–¥</button></div>

<div id="referral" class="page">
  <div class="card">
    <h3>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</h3>
    <p>–ü—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –¥—Ä—É–∑–µ–π –∏ –ø–æ–ª—É—á–∞–π—Ç–µ –±–æ–Ω—É—Å—ã!</p>
    <button class="btn" onclick="alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!')">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
    <button class="btn btn-red" onclick="showPage('earn')">–ù–∞–∑–∞–¥</button>
  </div>
</div>

<div id="withdraw" class="page">
  <div class="card">
    <h3>–í—ã–≤–æ–¥ –¥–µ–Ω–µ–≥</h3>
    <input id="card" placeholder="–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã –∏–ª–∏ –°–ë–ü">
    <input id="sum" type="number" placeholder="–°—É–º–º–∞ (–æ—Ç 100‚ÇΩ)">
    <button class="btn" onclick="alert('–ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞!')">–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É</button>
    <button class="btn btn-red" onclick="showPage('profile')">–ù–∞–∑–∞–¥</button>
  </div>
</div>

<div id="info" class="page">
  <div class="card">
    <button class="btn" onclick="window.tg.openTelegramLink('https://t.me/news')">–ö–∞–Ω–∞–ª —Å –Ω–æ–≤–æ—Å—Ç—è–º–∏</button>
    <div id="adm-btn-box">
        <script>
            setTimeout(() => {
                if(window.tg.initDataUnsafe?.user?.id === 7020322752) {
                    const b = document.createElement("button");
                    b.className = "btn"; b.style.background = "orange"; b.style.color = "black";
                    b.innerText = "–ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨";
                    b.onclick = () => showPage('admin-main');
                    document.getElementById("adm-btn-box").appendChild(b);
                }
            }, 2000);
        </script>
    </div>
  </div>
</div>

<div id="admin-main" class="page">
    <button class="btn" onclick="showPage('admin-reports')">üîé –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç—á–µ—Ç—ã</button>
    <button class="btn" onclick="showPage('admin-logs')">üìú –õ–æ–≥–∏ –¥–µ–π—Å—Ç–≤–∏–π</button>
    <button class="btn btn-red" onclick="showPage('info')">–ù–∞–∑–∞–¥</button>
</div>

<div id="admin-reports" class="page">
    <h3>–ó–∞–¥–∞–Ω–∏—è –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</h3>
    <div id="admin-reports-list"></div>
    <button class="btn btn-red" onclick="showPage('admin-main')">–ù–∞–∑–∞–¥</button>
</div>

<div id="admin-logs" class="page">
    <h3>–ñ—É—Ä–Ω–∞–ª —Å–æ–±—ã—Ç–∏–π</h3>
    <div id="admin-logs-list" class="card"></div>
    <button class="btn btn-red" onclick="showPage('admin-main')">–ù–∞–∑–∞–¥</button>
</div>

<div class="nav">
  <img src="https://i.postimg.cc/9MfvXtnQ/Picsart-26-01-03-07-41-15-897.png" onclick="nav('earn', event)" class="active">
  <img src="https://i.postimg.cc/jdGK89kw/Picsart-26-01-03-07-38-38-882.png" onclick="nav('profile', event)">
  <img src="https://i.postimg.cc/9fBhQfXL/Picsart-26-01-03-07-38-01-962.png" onclick="nav('info', event)">
</div>

</body>
</html>

