<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EASY MONEY - OFFICIAL</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
  import { getDatabase, ref, set, get, onValue, update, push } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyApcL3hN95djDhI-26L623jHHbzREswfQE",
    authDomain: "cash-1968a.firebaseapp.com",
    databaseURL: "https://cash-1968a-default-rtdb.firebaseio.com",
    projectId: "cash-1968a",
    storageBucket: "cash-1968a.appspot.com",
    messagingSenderId: "234016139024",
    appId: "1:234016139024:web:f11daa0328ff06173d2795"
  };
  const app = initializeApp(firebaseConfig);
  window.db = getDatabase(app);

  const tg = window.Telegram.WebApp;
  tg.expand();
  window.tg = tg;

  let uid = tg.initDataUnsafe?.user?.id || 0;
  let balance = 0;
  let energy = 1000;
  let userReports = {}; 
  const adminID = 7020322752;

  const userRef = ref(window.db, "users/" + uid);

  setTimeout(() => { document.getElementById("loader").style.display = "none"; }, 2500);

  // ИНИЦИАЛИЗАЦИЯ + ЭНЕРГИЯ 24ч
  get(userRef).then(snap => {
    const now = Date.now();
    const startParam = tg.initDataUnsafe?.start_param;
    if(!snap.exists()){
      let userData = { balance: 0, energy: 1000, lastEnergyReset: now, uid: uid };
      if(startParam && startParam != uid) userData.referrer = startParam;
      set(userRef, userData);
    } else {
      const data = snap.val();
      if(now - (data.lastEnergyReset || 0) > 86400000) {
        update(userRef, {energy: 1000, lastEnergyReset: now});
      }
    }
  });

  // ОБНОВЛЕНИЕ ДАННЫХ
  onValue(userRef, s => {
    const d = s.val();
    if(d){
      balance = d.balance || 0;
      energy = d.energy || 0;
      document.getElementById("balance").innerText = balance.toFixed(2);
      document.getElementById("energy").innerText = energy;
      document.getElementById("uid_display").innerText = uid;
      if(tg.initDataUnsafe?.user?.photo_url) document.getElementById("profilePic").src = tg.initDataUnsafe.user.photo_url;
      const img = document.querySelector(".click-img");
      img.style.opacity = energy <= 0 ? "0.4" : "1";
    }
  });

  // ОТЧЕТЫ И ИСТОРИЯ
  onValue(ref(window.db, "reports"), s => {
    userReports = {};
    const h1 = document.getElementById("hist-money"), h2 = document.getElementById("hist-done"), h3 = document.getElementById("hist-bad");
    h1.innerHTML = h2.innerHTML = h3.innerHTML = "";
    s.forEach(c => {
      const r = c.val();
      if(r.uid === uid) {
        userReports[r.taskId] = r.status;
        const item = `<div class="card" style="padding:10px; margin-bottom:5px;">${r.taskName}<br><b>${r.price}₽</b></div>`;
        if(r.status === "approved") { h1.innerHTML += item; h2.innerHTML += item; }
        else if(r.status === "rejected") { h3.innerHTML += item; }
      }
    });
  });

  // ЗАДАНИЯ
  onValue(ref(window.db, "tasks"), s => {
    const list = document.getElementById("task-list");
    list.innerHTML = "";
    s.forEach(c => {
      const t = c.val();
      const st = userReports[c.key] || "";
      const icon = st === "pending" ? "⏳" : (st === "approved" ? "✅" : "");
      const d = document.createElement("div");
      d.className = "card";
      d.innerHTML = `<strong>${t.name} ${icon}</strong> <span style="float:right">${t.price}₽</span>`;
      d.onclick = () => openTaskDetails(c.key, t);
      list.appendChild(d);
    });
  });

  // АДМИН-ФУНКЦИИ
  if(uid === adminID) {
    document.getElementById("admin-entry").style.display = "block";
    onValue(ref(window.db, "reports"), s => {
      const cont = document.getElementById("admin-reports-list");
      cont.innerHTML = "";
      s.forEach(c => {
        const r = c.val();
        if(r.status === "pending") {
          cont.innerHTML += `<div class="card">Юзер: ${r.uid}<br>Задание: ${r.taskName}<br>
            <button class="btn" style="background:green" onclick="approveReport('${c.key}')">Одобрить</button>
            <button class="btn btn-red" onclick="rejectReport('${c.key}')">Отклонить</button></div>`;
        }
      });
    });
    onValue(ref(window.db, "logs"), s => {
        const cont = document.getElementById("admin-logs-list");
        cont.innerHTML = "";
        let logs = []; s.forEach(c => logs.push(c.val()));
        logs.reverse().slice(0, 50).forEach(l => {
            cont.innerHTML += `<div style="font-size:11px; border-bottom:1px solid #444; margin-bottom:5px;">[${l.time}] ${l.msg}</div>`;
        });
    });
  }

  // ОБЩИЕ ФУНКЦИИ
  window.showPage = id => {
    document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
    document.getElementById(id).classList.add("active");
  };

  window.nav = (id, ev) => {
    document.querySelectorAll(".nav img").forEach(i=>i.classList.remove("active"));
    showPage(id);
    ev.target.classList.add("active");
  };

  window.tap = () => {
    if(energy <= 0) return;
    energy--; balance += 0.005;
    update(userRef, {balance, energy});
  };

  window.openTaskDetails = (id, task) => {
    document.getElementById("det-title").innerText = task.name;
    document.getElementById("det-desc").innerText = task.desc;
    document.getElementById("det-price").innerText = task.price;
    document.getElementById("det-link-btn").onclick = () => window.tg.openLink(task.link);
    showPage('task-details');
  };

  window.sendTaskReport = (taskId, task) => {
    const info = document.getElementById("det-input").value;
    if(!info) return alert("Введите отчет!");
    push(ref(window.db, "reports"), {uid, taskId, taskName: task.name, info, price: task.price, status: "pending"});
    showPage('tasks');
  };

  window.approveReport = (reportId) => {
    get(ref(window.db, `reports/${reportId}`)).then(s => {
      const r = s.val();
      const targetUserRef = ref(window.db, `users/${r.uid}`);
      get(targetUserRef).then(usnap => {
        const uData = usnap.val();
        update(targetUserRef, {balance: (uData.balance || 0) + r.price});
        update(ref(window.db, `reports/${reportId}`), {status: "approved"});
        if(uData.referrer) {
          const bossRef = ref(window.db, `users/${uData.referrer}`);
          get(bossRef).then(bsnap => {
            if(bsnap.exists()){
              const bonus = r.price * 0.10;
              update(bossRef, { balance: (bsnap.val().balance || 0) + bonus });
              push(ref(window.db, "logs"), {uid: 0, msg: `Реф. бонус ${bonus.toFixed(2)}₽ юзеру ${uData.referrer}`, time: new Date().toLocaleTimeString()});
            }
          });
        }
      });
    });
  };

  window.rejectReport = (id) => { update(ref(window.db, `reports/${id}`), {status: "rejected"}); };

  window.addTask = () => {
    const name = document.getElementById("adminTaskName").value;
    const price = Number(document.getElementById("adminTaskPrice").value);
    const desc = document.getElementById("adminTaskDesc").value;
    const link = document.getElementById("adminTaskLink").value;
    push(ref(window.db,"tasks"), {name, price, desc, link});
    alert("Задание добавлено!");
  };

</script>

<style>
*{box-sizing:border-box}
body{margin:0;height:100vh;font-family:Arial,sans-serif;color:white;background:url("https://i.postimg.cc/2jx4fT8X/Giga-Chat-40.jpg") center/cover;overflow:hidden;}
#loader{position:fixed;top:0;left:0;width:100%;height:100%;background:#111;display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:9999;}
.loader-logo{width:120px;animation:pulse 1.5s infinite;}
@keyframes pulse{0%{transform:scale(1);} 50%{transform:scale(1.1); opacity:0.8;} 100%{transform:scale(1);}}
.top{display:flex;justify-content:space-between;padding:15px;align-items:center;}
.title{font-size:20px;font-weight:900;padding:8px;background:rgba(255,255,255,0.1);border:1px solid white;border-radius:12px;backdrop-filter:blur(5px);}
.page{display:none;padding:20px;height:calc(100% - 150px);overflow-y:auto;}
.active{display:block}
.card{background:rgba(0,0,0,0.55);border:1px solid white;border-radius:18px;padding:15px;margin-bottom:15px;}
.btn{width:100%;padding:15px;margin-top:10px;background:rgba(0,0,0,0.4);border:1px solid white;color:white;border-radius:12px;font-weight:bold;cursor:pointer;}
.btn-red{background:rgba(255,0,0,0.25);}
.nav{position:fixed;bottom:0;width:100%;height:85px;background:rgba(0,0,0,0.8);display:flex;justify-content:space-around;align-items:center;}
.nav img{width:45px;opacity:0.5;}
.nav img.active{opacity:1;}
.click-img{width:190px;margin:20px auto;display:block;border-radius:22px;border:2px solid white;}
input, textarea{width:100%;padding:12px;margin-top:10px;border-radius:10px;border:1px solid white;background:rgba(0,0,0,0.3);color:white;}
.faq-content {font-size: 14px; line-height: 1.6;}
.faq-content h3 {border-bottom: 1px solid white; padding-bottom: 5px; margin-top: 20px;}
.faq-content b {color: #ffcc00;}
</style>
</head>
<body>

<div id="loader"><img class="loader-logo" src="https://i.postimg.cc/cCspvTn2/Picsart-26-01-03-04-33-45-909.png"></div>

<div class="top">
  <div class="title">EASY MONEY</div>
  <div class="balance" onclick="showPage('withdraw')">Баланс: <span id="balance">0.00</span>₽</div>
</div>

<div id="earn" class="page active">
  <div class="card">
    <button class="btn" onclick="showPage('referral')">Заработок на рефералах</button>
    <button class="btn" onclick="showPage('tasks')">Заработок на заданиях</button>
    <button class="btn" onclick="showPage('click')">Заработок на кликах</button>
  </div>
</div>

<div id="info" class="page">
  <div class="card">
    <button class="btn" onclick="window.tg.openTelegramLink('https://t.me/DifferentEarningsNews')">Новостной канал</button>
    <button class="btn" onclick="window.tg.openTelegramLink('https://t.me/wddsq')">Поддержка</button>
    <button class="btn" onclick="showPage('faq-page')">Руководство по использованию</button>
    <div id="admin-entry" style="display:none">
        <button class="btn" style="background:orange; color:black; margin-top:20px;" onclick="showPage('admin-main')">Админ-панель</button>
    </div>
  </div>
</div>

<div id="faq-page" class="page">
    <div class="card faq-content">
        <h2 style="text-align:center">Руководство пользователя</h2>
        
        <h3>1. Как начать зарабатывать?</h3>
        <p><b>Задания:</b> Выполняйте простые задачи в разделе «Задания». После выполнения отправьте отчет. После проверки админом деньги будут начислены.</p>
        <p><b>Кликер:</b> Просто нажимайте на изображение и получайте по 0.005₽ за тап. Энергия (1000 тапов) восстанавливается раз в 24 часа.</p>
        <p><b>Рефералы:</b> Приглашайте друзей по ссылке. Вы будете получать <b>10%</b> от каждого задания, которое выполнит ваш друг!</p>

        <h3>2. Личный кабинет</h3>
        <p>В профиле вы найдете свой <b>ID</b>, а также историю всех начислений и статусы ваших отчетов (на проверке, одобрено или отклонено).</p>

        <h3>3. Вывод средств</h3>
        <p>Минимальная сумма вывода — <b>100₽</b>. Укажите номер карты и сумму, после чего админ обработает заявку в течение суток.</p>

        <h3>4. Правила</h3>
        <p>Запрещено использование автокликеров и создание фейковых отчетов. За нарушение — блокировка аккаунта без выплаты средств.</p>

        <button class="btn btn-red" onclick="showPage('info')">Закрыть</button>
    </div>
</div>

<div id="referral" class="page">
  <div class="card">
    <h3>Рефералы</h3>
    <p style="font-size:14px; color:#ffcc00;">Получайте 10% от заработка каждого приглашённого пользователя!</p>
    <p id="refLink" style="font-size:11px; word-break:break-all; background:rgba(255,255,255,0.1); padding:10px; border-radius:10px;"></p>
    <button class="btn" onclick="alert('Скопировано')">Копировать ссылку</button>
    <button class="btn btn-red" onclick="showPage('earn')">Назад</button>
  </div>
</div>

<div id="profile" class="page">
  <div class="card" style="text-align:center">
    <img id="profilePic" style="width:80px; height:80px; border-radius:50%; border:2px solid white; margin-bottom:10px;" src="">
    <p>ID: <span id="uid_display">0</span></p>
    <button class="btn" onclick="showPage('p-money')">История начислений</button>
    <button class="btn" onclick="showPage('p-done')">Выполненные задания</button>
    <button class="btn" onclick="showPage('p-bad')">Отклонённые задания</button>
    <button class="btn btn-red" onclick="showPage('withdraw')" style="margin-top:15px;">Вывести</button>
  </div>
</div>

<div id="tasks" class="page"><h3>Задания</h3><div id="task-list"></div><button class="btn btn-red" onclick="showPage('earn')">Назад</button></div>
<div id="task-details" class="page"><div class="card"><h3 id="det-title"></h3><p id="det-desc"></p><p>Награда: <span id="det-price"></span>₽</p><button class="btn" id="det-link-btn">Перейти</button><textarea id="det-input" placeholder="Отчет"></textarea><button class="btn" onclick="sendTaskReport()">Отправить</button><button class="btn btn-red" onclick="showPage('tasks')">Назад</button></div></div>
<div id="click" class="page"><div class="card" style="text-align:center"><p>Энергия: <span id="energy">1000</span>/1000</p><img class="click-img" src="https://i.postimg.cc/cCspvTn2/Picsart-26-01-03-04-33-45-909.png" onclick="tap()"><button class="btn btn-red" onclick="showPage('earn')">Назад</button></div></div>
<div id="withdraw" class="page"><div class="card"><h3>Вывод</h3><input id="card" placeholder="Карта"><input id="sumWithdraw" type="number" placeholder="Сумма"><button class="btn">Заявка</button><button class="btn btn-red" onclick="showPage('profile')">Назад</button></div></div>
<div id="p-money" class="page"><h3>Начисления</h3><div id="hist-money"></div><button class="btn btn-red" onclick="showPage('profile')">Назад</button></div>
<div id="p-done" class="page"><h3>Одобрено</h3><div id="hist-done"></div><button class="btn btn-red" onclick="showPage('profile')">Назад</button></div>
<div id="p-bad" class="page"><h3>Отказы</h3><div id="hist-bad"></div><button class="btn btn-red" onclick="showPage('profile')">Назад</button></div>

<div id="admin-main" class="page">
    <button class="btn" onclick="showPage('admin-tasks')">Создать задание</button>
    <button class="btn" onclick="showPage('admin-reports')">Проверка отчетов</button>
    <button class="btn" onclick="showPage('admin-logs')">Логи системы</button>
    <button class="btn btn-red" onclick="showPage('info')">Назад</button>
</div>
<div id="admin-tasks" class="page"><input id="adminTaskName" placeholder="Имя"><input id="adminTaskPrice" type="number" placeholder="Цена"><textarea id="adminTaskDesc" placeholder="Опись"></textarea><input id="adminTaskLink" placeholder="Линк"><button class="btn" onclick="addTask()">Добавить</button><button class="btn btn-red" onclick="showPage('admin-main')">Назад</button></div>
<div id="admin-reports" class="page"><div id="admin-reports-list"></div><button class="btn btn-red" onclick="showPage('admin-main')">Назад</button></div>
<div id="admin-logs" class="page"><div id="admin-logs-list" class="card"></div><button class="btn btn-red" onclick="showPage('admin-main')">Назад</button></div>

<div class="nav">
  <img src="https://i.postimg.cc/9MfvXtnQ/Picsart-26-01-03-07-41-15-897.png" onclick="nav('earn', event)" class="active">
  <img src="https://i.postimg.cc/jdGK89kw/Picsart-26-01-03-07-38-38-882.png" onclick="nav('profile', event)">
  <img src="https://i.postimg.cc/9fBhQfXL/Picsart-26-01-03-07-38-01-962.png" onclick="nav('info', event)">
</div>

<script>
    setTimeout(() => {
        const user = window.tg.initDataUnsafe?.user;
        if(user){
            document.getElementById("refLink").innerText = "https://t.me/DifferentEarningsBot?start=" + user.id;
            if(user.id === 7020322752) document.getElementById("admin-entry").style.display = "block";
        }
    }, 1000);
</script>

</body>
                                 </html>
