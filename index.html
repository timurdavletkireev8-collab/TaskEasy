<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Dog Money üê∂</title>
<style>
:root { --gold: linear-gradient(135deg,#ffcc00,#ff9f00);}
*{
    box-sizing:border-box;
    font-family:'Segoe UI',sans-serif;
    -webkit-tap-highlight-color: transparent;
    user-select: none;
}
html,body{margin:0;padding:0;height:100%;background:radial-gradient(circle at top,#fff2d6,#ffd28a);overflow:hidden;}

header{text-align:center;padding:20px 15px; z-index: 10;}
.header-img{width:100%;max-width:340px;border-radius:22px;box-shadow:0 14px 35px rgba(0,0,0,0.3);}
.small{font-size:14px;opacity:0.7;margin-top:8px;}

/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –ª–∏—Å—Ç–∞–Ω–∏—è */
.main-wrapper {
    position: relative;
    width: 100%;
    height: calc(100vh - 180px); /* –í—ã—Å–æ—Ç–∞ —Å —É—á–µ—Ç–æ–º —Ö–µ–¥–µ—Ä–∞ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
    overflow: hidden;
}

.container{
    position: absolute;
    width: 100%;
    height: 100%;
    padding: 15px;
    padding-bottom: 80px;
    overflow-y: auto;
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.4s;
}

/* –°–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –ª–∏—Å—Ç–∞–Ω–∏—è */
.section { display: block; position: absolute; width: 100%; transform: translateX(100%); opacity: 0; pointer-events: none;}
.section.active { transform: translateX(0); opacity: 1; pointer-events: auto; position: relative;}
.section.prev { transform: translateX(-100%); opacity: 0; }

.card{
    background:#fff;
    border-radius:22px;
    padding:18px;
    margin-bottom:16px;
    box-shadow:0 15px 35px rgba(0,0,0,0.12);
}

.btn{
    width:100%;
    padding:14px;
    border:none;
    border-radius:18px;
    font-size:16px;
    font-weight:600;
    cursor:pointer;
    background:var(--gold);
    box-shadow:0 8px 20px rgba(255,170,0,0.4);
    transition: transform 0.1s;
    color: #000;
}
.btn:active{transform:scale(0.96);}

nav{position:fixed;bottom:12px;left:12px;right:12px;height:64px;background:rgba(255,255,255,0.9);backdrop-filter:blur(15px);border-radius:22px;display:flex;padding:6px;z-index:999;box-shadow:0 10px 30px rgba(0,0,0,0.2);}
nav button{flex:1;border:none;background:none;border-radius:16px;font-size:13px;font-weight:600;cursor:pointer; transition: 0.3s;}
nav button.active{background:var(--gold); box-shadow: 0 6px 15px rgba(255,170,0,0.4);}

/* –ö–æ—Å—Ç–æ—á–∫–∏ */
.bone{
    position:fixed;
    font-size:26px;
    pointer-events:none;
    z-index:1000;
    animation: boneExplode 0.9s cubic-bezier(0.1, 0.8, 0.3, 1) forwards;
}
@keyframes boneExplode {
    0% { opacity: 1; transform: translate(0,0) scale(1) rotate(0deg); }
    100% { opacity: 0; transform: translate(var(--ex), var(--ey)) scale(1.4) rotate(var(--er)); }
}

#overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.96);display:none;z-index:10000;color:#fff;overflow:auto;padding:25px;}
#overlay .closeBtn{position:absolute;top:15px;right:15px;background:var(--gold);color:#000;border:none;padding:12px 20px;border-radius:15px;font-weight:bold;}

#adminTable { width: 100%; border-collapse: collapse; margin-top: 20px; }
#adminTable td { padding: 8px; border-bottom: 1px solid #333; font-size: 13px; }
#adminTable input { width: 50px; background: #222; color: #fff; border: 1px solid #444; border-radius: 4px; }
</style>
<script src="https://www.gstatic.com/firebasejs/10.2.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.2.0/firebase-firestore.js"></script>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>

<header>
  <img class="header-img" src="https://i.postimg.cc/nrrTt15j/Giga-Chat-36.jpg" alt="Dog Money">
  <div class="small">–õ–∏—Å—Ç–∞–π –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π üê∂</div>
</header>

<div class="main-wrapper">
  <div id="earn" class="container section active">
    <div class="card">
      <h2>üêæ –ö–ª–∏–∫–∏</h2>
      <button class="btn actionBtn" data-type="click">–ù–∞—á–∞—Ç—å üêï</button>
      <p id="clicks">–ö–ª–∏–∫–æ–≤: 0</p>
    </div>
    <div class="card">
      <h2>üìã –ó–∞–¥–∞–Ω–∏—è</h2>
      <button class="btn actionBtn" data-type="tasks">–°–º–æ—Ç—Ä–µ—Ç—å</button>
    </div>
    <div class="card">
      <h2>ü§ù –†–µ—Ñ–µ—Ä–∞–ª—ã</h2>
      <button class="btn actionBtn" data-type="referrals">–î—Ä—É–∑—å—è</button>
    </div>
  </div>

  <div id="profile" class="container section">
    <div class="card">
      <img src="" alt="–§–æ—Ç–æ" class="profile-photo" id="profilePhoto" style="width:64px;border-radius:50%">
      <h2 id="profileUsername">–ó–∞–≥—Ä—É–∑–∫–∞...</h2>
      <p>ID: <span id="profileId">‚Äî</span></p>
      <p>–ë–∞–ª–∞–Ω—Å: <b id="profileBalance">0 ü™ô</b></p>
    </div>
  </div>

  <div id="info" class="container section">
    <div class="card">
      <h2>üõ° –ê–¥–º–∏–Ω–∫–∞</h2>
      <button class="btn" id="openAdmin">–û—Ç–∫—Ä—ã—Ç—å –±–∞–∑—É</button>
    </div>
    <div class="card">
      <h2>üì∞ –ö–∞–Ω–∞–ª</h2>
      <button class="btn">–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è</button>
    </div>
  </div>
</div>

<nav>
  <button id="btn-earn" class="active" onclick="openSection('earn')">üí∞ –ò–≥—Ä–∞—Ç—å</button>
  <button id="btn-profile" onclick="openSection('profile')">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button>
  <button id="btn-info" onclick="openSection('info')">‚ÑπÔ∏è –ò–Ω—Ñ–æ</button>
</nav>

<div id="overlay">
  <button class="closeBtn" onclick="document.getElementById('overlay').style.display='none'">‚úñ</button>
  <div id="overlayContent"></div>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.ready();

// Firebase Config
const firebaseConfig = {
    apiKey: "AIzaSyDeY43dAjpJ2NxHneG4W66veHNBiQ5jhfA",
    authDomain: "dogsmoney.firebaseapp.com",
    projectId: "dogsmoney",
    storageBucket: "dogsmoney.firebasestorage.app",
    messagingSenderId: "339745413806",
    appId: "1:339745413806:web:08f8fdd856ee92a3002b3f"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let clicks = 0, balance = 0, userRef, userId = 0;
const sections = ['earn', 'profile', 'info'];

// –õ–∏—Å—Ç–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü
function openSection(targetId) {
    const currentIndex = sections.indexOf(document.querySelector('.section.active').id);
    const targetIndex = sections.indexOf(targetId);

    sections.forEach((id, index) => {
        const el = document.getElementById(id);
        const btn = document.getElementById('btn-' + id);
        
        el.classList.remove('active', 'prev');
        btn.classList.remove('active');

        if (index < targetIndex) {
            el.classList.add('prev');
        } else if (index === targetIndex) {
            el.classList.add('active');
            btn.classList.add('active');
        }
    });
    tg.HapticFeedback.impactOccurred("light");
}

function createBones(x, y) {
    for(let i=0; i<6; i++) {
        const bone = document.createElement("div");
        bone.className = "bone";
        bone.innerText = "ü¶¥";
        bone.style.left = x + "px";
        bone.style.top = y + "px";
        const ex = (Math.random() - 0.5) * 250;
        const ey = (Math.random() - 0.5) * 250 - 100;
        const er = Math.random() * 720;
        bone.style.setProperty('--ex', `${ex}px`);
        bone.style.setProperty('--ey', `${ey}px`);
        bone.style.setProperty('--er', `${er}deg`);
        document.body.appendChild(bone);
        setTimeout(() => bone.remove(), 900);
    }
}

document.addEventListener("mousedown", e => createBones(e.clientX, e.clientY));
document.addEventListener("touchstart", e => createBones(e.touches[0].clientX, e.touches[0].clientY));

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
function initUser(user) {
    userId = user.id;
    document.getElementById("profileUsername").innerText = "@" + (user.username || "Player");
    document.getElementById("profileId").innerText = userId;
    userRef = db.collection("users").doc(String(userId));
    userRef.get().then(docSnap => {
        if(!docSnap.exists) userRef.set({username: user.username || "User", balance: 0, clicks: 0});
        else {
            const data = docSnap.data();
            clicks = data.clicks || 0;
            document.getElementById("clicks").innerText = "–ö–ª–∏–∫–æ–≤: " + clicks;
            document.getElementById("profileBalance").innerText = (data.balance || 0) + " ü™ô";
        }
    });
}

document.querySelectorAll(".actionBtn").forEach(btn=>{
    btn.onclick = () => {
        const type = btn.dataset.type;
        const overlay = document.getElementById("overlay");
        const content = document.getElementById("overlayContent");
        overlay.style.display="block";
        if(type === 'click') {
            content.innerHTML = `<h2>–ñ–º–∏!</h2><button class="btn" id="tap">üê∂</button><h1 id="cc">${clicks}</h1>`;
            document.getElementById("tap").onclick = (e) => {
                clicks++;
                document.getElementById("cc").innerText = clicks;
                document.getElementById("clicks").innerText = "–ö–ª–∏–∫–æ–≤: " + clicks;
                userRef.update({clicks});
                createBones(e.clientX || e.touches[0].clientX, e.clientY || e.touches[0].clientY);
                tg.HapticFeedback.impactOccurred("medium");
            }
        }
    }
});

// –ê–¥–º–∏–Ω–∫–∞
document.getElementById("openAdmin").onclick = async () => {
    const content = document.getElementById("overlayContent");
    document.getElementById("overlay").style.display="block";
    content.innerHTML = `<h2>üõ° –ë–∞–∑–∞</h2><table id="adminTable"></table>`;
    const snap = await db.collection("users").get();
    snap.forEach(doc => {
        const data = doc.data();
        const row = document.getElementById("adminTable").insertRow();
        row.insertCell(0).innerText = data.username || "User";
        const bIn = document.createElement("input"); bIn.value = data.balance || 0; row.insertCell(1).appendChild(bIn);
        const save = document.createElement("button"); save.innerText = "üíæ";
        save.onclick = () => db.collection("users").doc(doc.id).update({balance: parseInt(bIn.value)});
        row.insertCell(2).appendChild(save);
    });
};

initUser(tg.initDataUnsafe?.user || {id: 12345, username: "Test"});
</script>
</body>
</html>
