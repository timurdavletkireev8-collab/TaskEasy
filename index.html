<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EASY MONEY - FULL RECOVERY</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
  import { getDatabase, ref, set, get, onValue, update, push } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyApcL3hN95djDhI-26L623jHHbzREswfQE",
    authDomain: "cash-1968a.firebaseapp.com",
    databaseURL: "https://cash-1968a-default-rtdb.firebaseio.com",
    projectId: "cash-1968a",
    storageBucket: "cash-1968a.appspot.com",
    messagingSenderId: "234016139024",
    appId: "1:234016139024:web:f11daa0328ff06173d2795"
  };
  const app = initializeApp(firebaseConfig);
  window.db = getDatabase(app);

  const tg = window.Telegram.WebApp;
  tg.expand();
  window.tg = tg;

  let uid = tg.initDataUnsafe?.user?.id || 0;
  let balance = 0;
  let energy = 1000;
  let userReports = {};
  const adminID = 7020322752;

  const userRef = ref(window.db, "users/" + uid);

  // –õ–û–ê–î–ï–†
  setTimeout(() => { document.getElementById("loader").style.display = "none"; }, 2500);

  // –≠–ù–ï–†–ì–ò–Ø 24 –ß–ê–°–ê
  get(userRef).then(snap => {
    const now = Date.now();
    if(snap.exists()){
      const d = snap.val();
      if(now - (d.lastReset || 0) > 86400000) update(userRef, {energy: 1000, lastReset: now});
    } else {
      set(userRef, {balance:0, energy:1000, lastReset: now, uid: uid});
    }
  });

  // –û–ë–ù–û–í–õ–ï–ù–ò–ï –î–ê–ù–ù–´–•
  onValue(userRef, snapshot => {
    const data = snapshot.val();
    if(data){
      balance = data.balance || 0;
      energy = data.energy || 0;
      document.getElementById("balance").innerText = balance.toFixed(2);
      document.getElementById("energy").innerText = energy;
      document.getElementById("uid").innerText = uid;
      if(tg.initDataUnsafe?.user?.photo_url) document.getElementById("profilePic").src = tg.initDataUnsafe.user.photo_url;
      
      const img = document.querySelector(".click-img");
      img.style.opacity = energy <= 0 ? "0.4" : "1";
    }
  });

  // –ò–°–¢–û–†–ò–Ø –ò –û–¢–ß–ï–¢–´
  onValue(ref(window.db, "reports"), s => {
    userReports = {};
    const h1 = document.getElementById("h-earn"), h2 = document.getElementById("h-done"), h3 = document.getElementById("h-bad");
    h1.innerHTML = h2.innerHTML = h3.innerHTML = "";
    s.forEach(c => {
      const r = c.val();
      if(r.uid === uid) {
        userReports[r.taskId] = r.status;
        const html = `<div class="card" style="margin:5px 0; padding:10px;">${r.taskName} - ${r.price}‚ÇΩ</div>`;
        if(r.status === "approved") { h1.innerHTML += html; h2.innerHTML += html; }
        if(r.status === "rejected") h3.innerHTML += html;
      }
    });
  });

  // –ó–ê–î–ê–ù–ò–Ø
  onValue(ref(window.db, "tasks"), s => {
    const list = document.getElementById("task-list");
    list.innerHTML = "";
    s.forEach(child => {
      const t = child.val();
      const div = document.createElement("div");
      div.className = "card task-item";
      const st = userReports[child.key] || "";
      const icon = st === "pending" ? "‚è≥" : (st === "approved" ? "‚úÖ" : "");
      div.innerHTML = `<span>${t.name} ${icon}</span> <b>${t.price}‚ÇΩ</b>`;
      div.onclick = () => openTask(child.key, t);
      list.appendChild(div);
    });
  });

  // –ê–î–ú–ò–ù–ö–ê
  if(uid === adminID) {
    document.getElementById("admin-entry").style.display = "block";
    onValue(ref(window.db, "reports"), s => {
      const cont = document.getElementById("adm-reports");
      cont.innerHTML = "";
      s.forEach(c => {
        const r = c.val();
        if(r.status === "pending") {
          const d = document.createElement("div");
          d.className = "card";
          d.innerHTML = `ID: ${r.uid}<br>–û—Ç—á–µ—Ç: ${r.info}<br>
            <button class="btn" style="background:green" onclick="approveTask('${c.key}')">–û–¥–æ–±—Ä–∏—Ç—å</button>
            <button class="btn btn-red" onclick="rejectTask('${c.key}')">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>`;
          cont.appendChild(d);
        }
      });
    });
    onValue(ref(window.db, "logs"), s => {
        const cont = document.getElementById("adm-logs");
        cont.innerHTML = "";
        let logs = []; s.forEach(c => logs.push(c.val()));
        logs.reverse().slice(0, 50).forEach(l => {
            cont.innerHTML += `<div style="font-size:10px; border-bottom:1px solid #444; margin-bottom:2px;">[${l.time}] ${l.msg}</div>`;
        });
    });
  }

  // –§–£–ù–ö–¶–ò–ò
  window.showPage = id => {
    document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
    document.getElementById(id).classList.add("active");
  };

  window.tap = () => {
    if(energy <= 0) return;
    energy--; balance += 0.005;
    update(userRef, {balance, energy});
  };

  window.openTask = (id, task) => {
    document.getElementById("t-name").innerText = task.name;
    document.getElementById("t-desc").innerText = task.desc;
    document.getElementById("t-price").innerText = task.price;
    document.getElementById("t-link").onclick = () => window.tg.openLink(task.link);
    const btn = document.getElementById("t-send");
    const st = userReports[id];
    if(st === "pending" || st === "approved") {
        btn.disabled = true; btn.style.opacity = "0.5";
        btn.innerText = st === "pending" ? "–ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ..." : "–í—ã–ø–æ–ª–Ω–µ–Ω–æ";
    } else {
        btn.disabled = false; btn.style.opacity = "1"; btn.innerText = "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç";
        btn.onclick = () => sendReport(id, task);
    }
    showPage('task-view');
  };

  window.sendReport = (id, task) => {
    const info = document.getElementById("t-input").value;
    if(!info) return alert("–í–≤–µ–¥–∏—Ç–µ –æ—Ç—á–µ—Ç!");
    push(ref(window.db, "reports"), {uid, taskId: id, taskName: task.name, info, price: task.price, status: "pending"});
    logAction(`–Æ–∑–µ—Ä ${uid} –æ—Ç–ø—Ä–∞–≤–∏–ª –æ—Ç—á–µ—Ç: ${task.name}`);
    showPage('tasks');
  };

  window.approveTask = id => {
    get(ref(window.db, `reports/${id}`)).then(s => {
      const r = s.val();
      const uR = ref(window.db, `users/${r.uid}`);
      get(uR).then(us => {
        update(uR, {balance: (us.val().balance || 0) + r.price});
        update(ref(window.db, `reports/${id}`), {status: "approved"});
        logAction(`–ê–¥–º–∏–Ω –û–î–û–ë–†–ò–õ –∑–∞–¥–∞—á—É —é–∑–µ—Ä–∞ ${r.uid} (+${r.price}‚ÇΩ)`, true);
      });
    });
  };

  window.rejectTask = id => {
    update(ref(window.db, `reports/${id}`), {status: "rejected"});
    logAction(`–ê–¥–º–∏–Ω –û–¢–ö–õ–û–ù–ò–õ –∑–∞–¥–∞—á—É`, true);
  };

  window.logAction = (msg) => {
    push(ref(window.db, "logs"), {uid, msg, time: new Date().toLocaleTimeString()});
  };

</script>

<style>
*{box-sizing:border-box}
body{margin:0;height:100vh;font-family:sans-serif;color:white;background:url("https://i.postimg.cc/2jx4fT8X/Giga-Chat-40.jpg") center/cover;overflow:hidden;}
#loader{position:fixed;top:0;left:0;width:100%;height:100%;background:#000;z-index:9999;display:flex;flex-direction:column;align-items:center;justify-content:center;}
.loader-logo{width:100px;animation:p 1.5s infinite;}
@keyframes p{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}
.top{display:flex;justify-content:space-between;padding:15px;align-items:center;}
.title{font-weight:900;border:1px solid white;padding:5px 10px;border-radius:10px;background:rgba(255,255,255,0.1);}
.page{display:none;padding:20px;height:calc(100vh - 150px);overflow-y:auto;}
.active{display:block}
.card{background:rgba(0,0,0,0.5);border:1px solid white;border-radius:15px;padding:15px;margin-bottom:15px;}
.btn{width:100%;padding:12px;margin-top:10px;background:rgba(0,0,0,0.4);border:1px solid white;color:white;border-radius:10px;font-weight:bold;cursor:pointer;}
.btn-red{background:rgba(255,0,0,0.2);border-color:#ff5555;}
.nav{position:fixed;bottom:0;width:100%;height:80px;background:rgba(0,0,0,0.8);display:flex;justify-content:space-around;align-items:center;}
.nav img{width:35px;opacity:0.5;}
.nav img.active{opacity:1;}
.click-img{width:180px;margin:20px auto;display:block;border-radius:20px;border:2px solid white;}
input, textarea{width:100%;padding:10px;margin-top:10px;background:rgba(0,0,0,0.3);border:1px solid white;color:white;border-radius:8px;}
</style>
</head>
<body>

<div id="loader"><img class="loader-logo" src="https://i.postimg.cc/cCspvTn2/Picsart-26-01-03-04-33-45-909.png"></div>

<div class="top">
  <div class="title">EASY MONEY</div>
  <div class="balance" onclick="showPage('withdraw')">–ë–∞–ª–∞–Ω—Å: <span id="balance">0.00</span>‚ÇΩ</div>
</div>

<div id="earn" class="page active">
  <div class="card">
    <button class="btn" onclick="showPage('referral')">–ó–∞—Ä–∞–±–æ—Ç–æ–∫ –Ω–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–∞—Ö</button>
    <button class="btn" onclick="showPage('tasks')">–ó–∞—Ä–∞–±–æ—Ç–æ–∫ –Ω–∞ –∑–∞–¥–∞–Ω–∏—è—Ö</button>
    <button class="btn" onclick="showPage('click')">–ó–∞—Ä–∞–±–æ—Ç–æ–∫ –Ω–∞ –∫–ª–∏–∫–∞—Ö</button>
  </div>
</div>

<div id="click" class="page">
  <div class="card" style="text-align:center">
    <p>–≠–Ω–µ—Ä–≥–∏—è: <span id="energy">1000</span>/1000</p>
    <img class="click-img" src="https://i.postimg.cc/cCspvTn2/Picsart-26-01-03-04-33-45-909.png" onclick="tap()">
    <button class="btn btn-red" onclick="showPage('earn')">–ù–∞–∑–∞–¥</button>
  </div>
</div>

<div id="tasks" class="page">
  <h3>–ó–∞–¥–∞–Ω–∏—è</h3>
  <div id="task-list"></div>
  <button class="btn btn-red" onclick="showPage('earn')">–ù–∞–∑–∞–¥</button>
</div>

<div id="task-view" class="page">
  <div class="card">
    <h3 id="t-name"></h3>
    <p id="t-desc"></p>
    <p>–ù–∞–≥—Ä–∞–¥–∞: <span id="t-price"></span>‚ÇΩ</p>
    <button class="btn" id="t-link" style="background:#0088cc">–ü–µ—Ä–µ–π—Ç–∏</button>
    <textarea id="t-input" placeholder="–û—Ç—á–µ—Ç (–Ω–∏–∫, —Å–∫—Ä–∏–Ω –∏ —Ç–¥)"></textarea>
    <button class="btn" id="t-send" style="background:green">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç</button>
    <button class="btn btn-red" onclick="showPage('tasks')">–ù–∞–∑–∞–¥</button>
  </div>
</div>

<div id="profile" class="page">
  <div class="card" style="text-align:center">
    <img id="profilePic" src="https://via.placeholder.com/80" style="width:80px; border-radius:50%; margin-bottom:10px;">
    <p>ID: <span id="uid"></span></p>
    <button class="btn" onclick="showPage('h1')">üí∞ –ù–∞—á–∏—Å–ª–µ–Ω–∏—è</button>
    <button class="btn" onclick="showPage('h2')">‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ</button>
    <button class="btn" onclick="showPage('h3')">‚ùå –û—Ç–∫–ª–æ–Ω—ë–Ω–Ω—ã–µ</button>
    <button class="btn btn-red" onclick="showPage('withdraw')">–í—ã–≤–µ—Å—Ç–∏</button>
  </div>
</div>

<div id="h1" class="page"><h3>–ù–∞—á–∏—Å–ª–µ–Ω–∏—è</h3><div id="h-earn"></div><button class="btn btn-red" onclick="showPage('profile')">–ù–∞–∑–∞–¥</button></div>
<div id="h2" class="page"><h3>–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ</h3><div id="h-done"></div><button class="btn btn-red" onclick="showPage('profile')">–ù–∞–∑–∞–¥</button></div>
<div id="h3" class="page"><h3>–û—Ç–∫–ª–æ–Ω—ë–Ω–Ω—ã–µ</h3><div id="h-bad"></div><button class="btn btn-red" onclick="showPage('profile')">–ù–∞–∑–∞–¥</button></div>

<div id="referral" class="page">
  <div class="card">
    <h3>–†–µ—Ñ–µ—Ä–∞–ª—ã</h3>
    <p>–¢—É—Ç –≤–∞—à–∞ —Å—Å—ã–ª–∫–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏):</p>
    <button class="btn" onclick="alert('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ')">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
    <button class="btn btn-red" onclick="showPage('earn')">–ù–∞–∑–∞–¥</button>
  </div>
</div>

<div id="withdraw" class="page">
  <div class="card">
    <h3>–í—ã–≤–æ–¥</h3>
    <input placeholder="–ö–∞—Ä—Ç–∞">
    <input type="number" placeholder="–°—É–º–º–∞">
    <button class="btn">–í—ã–≤–µ—Å—Ç–∏</button>
    <button class="btn btn-red" onclick="showPage('profile')">–ù–∞–∑–∞–¥</button>
  </div>
</div>

<div id="info" class="page">
  <div class="card">
    <button class="btn" onclick="window.tg.openTelegramLink('https://t.me/news')">–ù–æ–≤–æ—Å—Ç–∏</button>
    <div id="admin-entry" style="display:none">
        <button class="btn" style="background:orange; color:black" onclick="showPage('admin-m')">–ê–î–ú–ò–ù–ö–ê</button>
    </div>
  </div>
</div>

<div id="admin-m" class="page">
    <button class="btn" onclick="showPage('adm-r')">–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—á–µ—Ç–æ–≤</button>
    <button class="btn" onclick="showPage('adm-l')">–õ–æ–≥–∏ –¥–µ–π—Å—Ç–≤–∏–π</button>
    <button class="btn btn-red" onclick="showPage('info')">–ù–∞–∑–∞–¥</button>
</div>

<div id="adm-r" class="page"><div id="adm-reports"></div><button class="btn btn-red" onclick="showPage('admin-m')">–ù–∞–∑–∞–¥</button></div>
<div id="adm-l" class="page"><div id="adm-logs" class="card"></div><button class="btn btn-red" onclick="showPage('admin-m')">–ù–∞–∑–∞–¥</button></div>

<div class="nav">
  <img src="https://i.postimg.cc/9MfvXtnQ/Picsart-26-01-03-07-41-15-897.png" onclick="nav('earn', this)" class="active">
  <img src="https://i.postimg.cc/jdGK89kw/Picsart-26-01-03-07-38-38-882.png" onclick="nav('profile', this)">
  <img src="https://i.postimg.cc/9fBhQfXL/Picsart-26-01-03-07-38-01-962.png" onclick="nav('info', this)">
</div>

<script>
    function nav(id, el) {
        document.querySelectorAll(".nav img").forEach(i => i.classList.remove("active"));
        el.classList.add("active");
        showPage(id);
    }
</script>

</body>
</html>
