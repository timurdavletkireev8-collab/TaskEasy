<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Dog Money üê∂</title>
<style>
:root { --gold: linear-gradient(135deg,#ffcc00,#ff9f00);}
*{
    box-sizing:border-box;
    font-family:'Segoe UI',sans-serif;
    -webkit-tap-highlight-color: transparent;
    user-select: none;
    outline: none;
}
html,body{margin:0;padding:0;height:100%;background:radial-gradient(circle at top,#fff2d6,#ffd28a);overflow:hidden;}

header{text-align:center;padding:15px; z-index: 100;}
.header-img{width:100%;max-width:280px;border-radius:22px;box-shadow:0 10px 25px rgba(0,0,0,0.2);}
.small{font-size:13px;opacity:0.7;margin-top:5px; color: #5d4037;}

/* –û–±–æ–ª–æ—á–∫–∞ –¥–ª—è —Å–ª–∞–π–¥–∏–Ω–≥–∞ */
.viewport {
    position: relative;
    width: 100%;
    height: calc(100vh - 180px);
    overflow: hidden;
}

.section {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    padding: 15px;
    transition: transform 0.4s ease-in-out, opacity 0.3s;
    overflow-y: auto;
    opacity: 0;
    visibility: hidden;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–∑–∏—Ü–∏–π —Å—Ç—Ä–∞–Ω–∏—Ü */
.section.active { opacity: 1; visibility: visible; transform: translateX(0); }
.section.left { transform: translateX(-100%); }
.section.right { transform: translateX(100%); }

.card{
    background: rgba(255,255,255,0.95);
    border-radius: 22px;
    padding: 18px;
    margin-bottom: 16px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.06);
}

.btn{
    width:100%;
    padding:14px;
    border:none;
    border-radius:18px;
    font-size:16px;
    font-weight:700;
    background:var(--gold);
    box-shadow:0 6px 15px rgba(255,170,0,0.4);
    transition: transform 0.1s;
    color: #000;
    cursor: pointer;
}
.btn:active{transform:scale(0.95);}

nav{
    position:fixed;
    bottom:15px;
    left:15px;
    right:15px;
    height:68px;
    background:rgba(255,255,255,0.98);
    backdrop-filter:blur(10px);
    border-radius:25px;
    display:flex;
    padding:7px;
    z-index:999;
    box-shadow:0 10px 30px rgba(0,0,0,0.1);
}
nav button{
    flex:1;
    border:none;
    background:none;
    border-radius:18px;
    font-size:12px;
    font-weight:700;
    color: #8d6e63;
    transition: 0.3s;
}
nav button.active{
    background:var(--gold);
    color: #000;
    box-shadow: 0 4px 12px rgba(255,170,0,0.3);
}

.bone{
    position:fixed;
    font-size:28px;
    pointer-events:none;
    z-index:9999;
    animation: explode 0.8s ease-out forwards;
}
@keyframes explode {
    0% { opacity: 1; transform: translate(0,0) scale(1); }
    100% { opacity: 0; transform: translate(var(--x), var(--y)) rotate(var(--r)) scale(1.5); }
}

#overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.98);display:none;z-index:10000;color:#fff;padding:25px;overflow-y:auto;}
.closeBtn{float:right; background:var(--gold); border:none; padding:10px; border-radius:12px; font-weight:bold;}

#adminTable { width: 100%; margin-top: 20px; border-collapse: collapse; }
#adminTable td { padding: 10px; border-bottom: 1px solid #333; }
#adminTable input { width: 60px; background: #222; color: #fff; border: 1px solid #444; border-radius: 5px; }
</style>

<script src="https://www.gstatic.com/firebasejs/10.2.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.2.0/firebase-firestore.js"></script>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>

<header>
  <img class="header-img" src="https://i.postimg.cc/nrrTt15j/Giga-Chat-36.jpg">
  <div class="small">–õ–∏—Å—Ç–∞–π –∏ —Å–æ–±–∏—Ä–∞–π –∫–æ—Å—Ç–æ—á–∫–∏ ü¶¥</div>
</header>

<div class="viewport">
  <div id="earn" class="section active">
    <div class="card">
      <h2>üêæ –ö–ª–∏–∫–µ—Ä</h2>
      <button class="btn" onclick="openTapOverlay()">–û–¢–ö–†–´–¢–¨ –ö–õ–ò–ö–ï–† üêï</button>
      <h3 id="clicksDisp">–ö–ª–∏–∫–æ–≤: 0</h3>
    </div>
    <div class="card">
      <h2>üìã –ó–∞–¥–∞–Ω–∏—è</h2>
      <button class="btn" onclick="tg.showAlert('–°–∫–æ—Ä–æ!')">–ó–∞–¥–∞–Ω–∏—è</button>
    </div>
  </div>

  <div id="profile" class="section right">
    <div class="card" style="text-align:center;">
      <h2 id="pName">@user</h2>
      <p>ID: <span id="pId">0</span></p>
      <p>–ë–∞–ª–∞–Ω—Å: <b id="pBal">0</b> ü™ô</p>
    </div>
  </div>

  <div id="info" class="section right">
    <div class="card">
      <h2>üõ° –ê–¥–º–∏–Ω–∫–∞</h2>
      <button class="btn" onclick="openAdmin()">–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö</button>
    </div>
    <div class="card">
      <h2>üì¢ –ö–∞–Ω–∞–ª</h2>
      <button class="btn">–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è</button>
    </div>
  </div>
</div>

<nav>
  <button id="nav-earn" class="active" onclick="showPage('earn')">üí∞ –ò–≥—Ä–∞—Ç—å</button>
  <button id="nav-profile" onclick="showPage('profile')">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button>
  <button id="nav-info" onclick="showPage('info')">‚ÑπÔ∏è –ò–Ω—Ñ–æ</button>
</nav>

<div id="overlay">
  <button class="closeBtn" onclick="closeOverlay()">–ó–∞–∫—Ä—ã—Ç—å</button>
  <div id="overlayContent"></div>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.ready();

const firebaseConfig = {
    apiKey: "AIzaSyDeY43dAjpJ2NxHneG4W66veHNBiQ5jhfA",
    authDomain: "dogsmoney.firebaseapp.com",
    projectId: "dogsmoney",
    storageBucket: "dogsmoney.firebasestorage.app",
    messagingSenderId: "339745413806",
    appId: "1:339745413806:web:08f8fdd856ee92a3002b3f"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let clicks = 0, balance = 0, userRef, userId = 0;
const pageIds = ['earn', 'profile', 'info'];

// –§–£–ù–ö–¶–ò–Ø –õ–ò–°–¢–ê–ù–ò–Ø
function showPage(targetId) {
    const targetIdx = pageIds.indexOf(targetId);
    
    pageIds.forEach((id, idx) => {
        const el = document.getElementById(id);
        const btn = document.getElementById('nav-' + id);
        el.classList.remove('active', 'left', 'right');
        btn.classList.remove('active');

        if (idx === targetIdx) {
            el.classList.add('active');
            btn.classList.add('active');
        } else if (idx < targetIdx) {
            el.classList.add('left');
        } else {
            el.classList.add('right');
        }
    });
    tg.HapticFeedback.impactOccurred("light");
}

// –≠–§–§–ï–ö–¢ –ö–û–°–¢–û–ß–ï–ö
function burst(x, y) {
    for(let i=0; i<6; i++) {
        const b = document.createElement("div");
        b.className = "bone"; b.innerText = "ü¶¥";
        b.style.left = x + "px"; b.style.top = y + "px";
        const vx = (Math.random() - 0.5) * 300;
        const vy = (Math.random() - 0.5) * 300 - 100;
        const vr = Math.random() * 360;
        b.style.setProperty('--x', vx + "px");
        b.style.setProperty('--y', vy + "px");
        b.style.setProperty('--r', vr + "deg");
        document.body.appendChild(b);
        setTimeout(() => b.remove(), 800);
    }
}

document.addEventListener("mousedown", e => burst(e.clientX, e.clientY));
document.addEventListener("touchstart", e => burst(e.touches[0].clientX, e.touches[0].clientY));

// FIREBASE –ò–ù–ò–¢
function start() {
    const user = tg.initDataUnsafe?.user || {id: 7020322752, username: "Player"};
    userId = user.id;
    document.getElementById("pName").innerText = "@" + (user.username || "User");
    document.getElementById("pId").innerText = userId;
    
    userRef = db.collection("users").doc(String(userId));
    userRef.get().then(doc => {
        if(!doc.exists) userRef.set({username: user.username || "User", balance:0, clicks:0});
        else {
            const d = doc.data();
            clicks = d.clicks || 0; balance = d.balance || 0;
            document.getElementById("clicksDisp").innerText = "–ö–ª–∏–∫–æ–≤: " + clicks;
            document.getElementById("pBal").innerText = balance;
        }
    });
}

function openTapOverlay() {
    const ov = document.getElementById("overlay");
    const cnt = document.getElementById("overlayContent");
    ov.style.display = "block";
    cnt.innerHTML = `<div id="tapTarget" style="width:200px; height:200px; background:var(--gold); border-radius:50%; margin: 50px auto; display:flex; align-items:center; justify-content:center; font-size:80px; box-shadow:0 0 30px rgba(255,170,0,0.5)">üê∂</div><h1 id="count" style="text-align:center">${clicks}</h1>`;
    
    document.getElementById("tapTarget").onclick = (e) => {
        clicks++;
        document.getElementById("count").innerText = clicks;
        document.getElementById("clicksDisp").innerText = "–ö–ª–∏–∫–æ–≤: " + clicks;
        userRef.update({clicks});
        burst(e.clientX || e.touches[0].clientX, e.clientY || e.touches[0].clientY);
        tg.HapticFeedback.impactOccurred("medium");
    };
}

async function openAdmin() {
    const ov = document.getElementById("overlay");
    const cnt = document.getElementById("overlayContent");
    ov.style.display = "block";
    cnt.innerHTML = `<h2>üõ° –ë–∞–∑–∞</h2><table id="adminTable"></table>`;
    const snap = await db.collection("users").get();
    snap.forEach(doc => {
        const d = doc.data();
        const row = document.getElementById("adminTable").insertRow();
        row.insertCell(0).innerText = d.username || "???";
        const inp = document.createElement("input"); inp.value = d.balance || 0;
        row.insertCell(1).appendChild(inp);
        const save = document.createElement("button"); save.innerText = "OK";
        save.onclick = () => db.collection("users").doc(doc.id).update({balance: parseInt(inp.value)});
        row.insertCell(2).appendChild(save);
    });
}

function closeOverlay() { document.getElementById("overlay").style.display = "none"; }

start();
</script>
</body>
</html>
