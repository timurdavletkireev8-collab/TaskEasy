<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Easy Money</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
import { getDatabase, ref, set, get, update, onValue, push } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyApcL3hN95djDhI-26L623jHHbzREswfQE",
  authDomain: "cash-1968a.firebaseapp.com",
  databaseURL: "https://cash-1968a-default-rtdb.firebaseio.com",
  projectId: "cash-1968a",
  storageBucket: "cash-1968a.firebasestorage.app",
  messagingSenderId: "234016139024",
  appId: "1:234016139024:web:f11daa0328ff06173d2795",
  measurementId: "G-MFEKWBVN21"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const tg = window.Telegram.WebApp;
tg.expand();

const userID = tg.initDataUnsafe?.user?.id || Date.now();
const adminID = 7020322752;

const userRef = ref(db,'users/'+userID);
const tasksRef = ref(db,'tasks');
const reportsRef = ref(db,'reports');

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
get(userRef).then(snapshot=>{
  if(!snapshot.exists()){
    set(userRef,{
      balance:0,
      energy:1000,
      referrals:0,
      completedTasks:0,
      rejectedTasks:0
    });
  }
});

// –§—É–Ω–∫—Ü–∏–∏
window.tap = function(){
  get(userRef).then(snapshot=>{
    let data = snapshot.val();
    if(data.energy<=0){alert("–≠–Ω–µ—Ä–≥–∏—è –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å"); return;}
    const newEnergy = data.energy-1;
    const newBalance = +(data.balance+0.005).toFixed(3);
    update(userRef,{energy:newEnergy,balance:newBalance});
  });
}

function updateEnergyUI(energy){ 
  const percent = (energy/1000)*100; 
  document.getElementById("energy-bar").style.width = percent+"%";
  document.getElementById("energy-text").innerText = `–≠–Ω–µ—Ä–≥–∏—è: ${energy}/1000`;
}

onValue(userRef, snapshot=>{
  const data = snapshot.val();
  if(data){
    updateEnergyUI(data.energy);
    document.getElementById('balance-text').innerText = data.balance.toFixed(3);
    document.getElementById('completed-tasks').innerText = data.completedTasks;
    document.getElementById('rejected-tasks').innerText = data.rejectedTasks;
  }
});

// –ù–∞–≤–∏–≥–∞—Ü–∏—è
window.showPage = function(id){
  document.querySelectorAll('.page').forEach(p=>p.style.display='none');
  document.getElementById(id).style.display='block';
}

// –†–µ—Ñ–µ—Ä–∞–ª—ã
window.showReferral = function(){
  showPage('referral');
  const refLink = `https://t.me/DifferentEarningsBot?start=${userID}`;
  document.getElementById('ref-link').value = refLink;
}

window.copyReferral = function(){
  const copyText = document.getElementById('ref-link');
  copyText.select();
  copyText.setSelectionRange(0, 99999);
  navigator.clipboard.writeText(copyText.value);
  alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
}

// –ó–∞–¥–∞–Ω–∏—è
window.showTasks = function(){
  showPage('tasks');
  const tasksList = document.getElementById('tasks-list');
  tasksList.innerHTML='';
  get(tasksRef).then(snapshot=>{
    snapshot.forEach(snap=>{
      const task = snap.val();
      const key = snap.key;
      const div = document.createElement('div');
      div.className='card';
      div.innerHTML = `<b>${task.name}</b><p>${task.desc}</p><p>–¶–µ–Ω–∞: ${task.price}‚ÇΩ</p><button class="btn" onclick="openTask('${key}')">–û—Ç–∫—Ä—ã—Ç—å</button>`;
      tasksList.appendChild(div);
    });
  });
}

window.openTask = function(key){
  showPage('task-detail');
  get(ref(db,'tasks/'+key)).then(snapshot=>{
    const task = snapshot.val();
    document.getElementById('task-title').innerText = task.name;
    document.getElementById('task-desc').innerText = task.desc;
    document.getElementById('task-price').innerText = task.price+"‚ÇΩ";
    document.getElementById('task-link').onclick = ()=>window.open(task.link,'_blank');
    document.getElementById('submit-report').onclick = ()=>submitReport(key);
  });
}

window.submitReport = function(taskKey){
  const report = document.getElementById('report-text').value;
  if(report==''){alert('–í–≤–µ–¥–∏—Ç–µ –æ—Ç—á–µ—Ç'); return;}
  push(reportsRef,{
    userID:userID,
    taskKey:taskKey,
    report:report,
    status:'pending'
  });
  alert('–ó–∞–¥–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É!');
  showTasks();
}

</script>
<style>
body{margin:0;font-family:'Arial Black',sans-serif;color:white;overflow:hidden;}
.top{display:flex;justify-content:space-between;align-items:center;padding:10px;height:80px;background:url('https://i.postimg.cc/dQ2QDSbQ/Picsart-26-01-03-04-31-27-278.png') center/cover no-repeat;}
.title{font-size:36px;font-weight:bold;}
.balance{cursor:pointer;}
.page{display:none;padding:20px;height:calc(100% - 80px);}
.page.active{display:block;}
.btn{padding:14px 22px;border-radius:15px;background:rgba(0,0,0,0.6);border:2px solid white;color:white;font-weight:bold;margin:10px;cursor:pointer;display:inline-block;}
.btn-red{background:rgba(255,0,0,0.4);}
.card{background:rgba(0,0,0,0.5);border-radius:20px;padding:20px;margin-bottom:15px;}
.nav{position:fixed;bottom:0;width:100%;display:flex;justify-content:space-around;padding:10px;background:rgba(0,0,0,0.5);}
.nav button{flex:1;margin:0 5px;}
.click-img{width:180px;height:180px;display:block;margin:20px auto;border-radius:20px;border:3px solid white;}
.energy-container{background:rgba(255,255,255,0.2);height:24px;border-radius:12px;position:relative;margin:12px 0;}
#energy-bar{background:#00ffcc;height:100%;width:100%;border-radius:12px;transition:width .2s;}
#energy-text{position:absolute;left:50%;top:0;transform:translateX(-50%);color:white;font-weight:bold;}
</style>
</head>
<body>

<div class="top">
  <div class="title">EASY MONEY</div>
  <div class="balance" onclick="alert('–í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤')">–ë–∞–ª–∞–Ω—Å: <span id="balance-text">0</span>‚ÇΩ</div>
</div>

<!-- –ó–∞—Ä–∞–±–æ—Ç–æ–∫ -->
<div id="earn" class="page active">
  <div class="card"><button class="btn" onclick="showReferral()">–ó–∞—Ä–∞–±–æ—Ç–æ–∫ –Ω–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–∞—Ö</button></div>
  <div class="card"><button class="btn" onclick="showTasks()">–ó–∞—Ä–∞–±–æ—Ç–æ–∫ –Ω–∞ –∑–∞–¥–∞–Ω–∏—è—Ö</button></div>
  <div class="card"><button class="btn" onclick="showPage('clicker')">–ó–∞—Ä–∞–±–æ—Ç–æ–∫ –Ω–∞ –∫–ª–∏–∫–∞—Ö</button></div>
</div>

<!-- –†–µ—Ñ–µ—Ä–∞–ª—ã -->
<div id="referral" class="page">
  <div class="card">
    <p>–ü—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –¥—Ä—É–∑–µ–π –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ 10‚ÇΩ + 200 —ç–Ω–µ—Ä–≥–∏–∏ —Å –∫–∞–∂–¥–æ–≥–æ!</p>
    <input id="ref-link" value="" readonly style="width:100%;padding:10px;border-radius:10px;text-align:center;">
    <button class="btn btn-red" onclick="copyReferral()">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
    <button class="btn btn-red" onclick="showPage('earn')">–ù–∞–∑–∞–¥</button>
  </div>
</div>

<!-- –ó–∞–¥–∞–Ω–∏—è -->
<div id="tasks" class="page">
  <div id="tasks-list"></div>
  <button class="btn btn-red" onclick="showPage('earn')">–ù–∞–∑–∞–¥</button>
</div>

<div id="task-detail" class="page">
  <div class="card">
    <h3 id="task-title"></h3>
    <p id="task-desc"></p>
    <p>–¶–µ–Ω–∞: <span id="task-price"></span></p>
    <button class="btn" id="task-link">–ü–µ—Ä–µ–π—Ç–∏</button>
    <textarea id="report-text" placeholder="–û—Ç–ø—Ä–∞–≤—å—Ç–µ –æ—Ç—á–µ—Ç" style="width:100%;height:80px;margin-top:10px;"></textarea>
    <button class="btn btn-red" id="submit-report">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç</button>
    <button class="btn btn-red" onclick="showTasks()">–ù–∞–∑–∞–¥</button>
  </div>
</div>

<!-- –ö–ª–∏–∫–µ—Ä -->
<div id="clicker" class="page">
  <div class="card">
    <div class="energy-container">
      <div id="energy-bar"></div>
      <span id="energy-text">–≠–Ω–µ—Ä–≥–∏—è: 1000/1000</span>
    </div>
    <img class="click-img" src="https://i.postimg.cc/cCspvTn2/Picsart-26-01-03-04-33-45-909.png" onclick="tap()">
    <button class="btn btn-red" onclick="showPage('earn')">–ù–∞–∑–∞–¥</button>
  </div>
</div>

<!-- –ü—Ä–æ—Ñ–∏–ª—å -->
<div id="profile" class="page">
  <div class="card">
    <p>ID: <span id="user-id"></span></p>
    <p>–§–æ—Ç–æ Telegram</p>
    <p>–í—ã–ø–æ–ª–Ω–µ–Ω–æ –∑–∞–¥–∞–Ω–∏–π: <span id="completed-tasks">0</span></p>
    <p>–û—Ç–∫–ª–æ–Ω–µ–Ω–æ –∑–∞–¥–∞–Ω–∏–π: <span id="rejected-tasks">0</span></p>
    <button class="btn btn-red">–í—ã–≤–µ—Å—Ç–∏</button>
  </div>
</div>

<!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
<div id="info" class="page">
  <div class="card">
    <button class="btn" onclick="window.open('https://t.me/news','_blank')">–ù–æ–≤–æ—Å—Ç–∏</button>
    <button class="btn" onclick="window.open('https://t.me/sup','_blank')">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</button>
    <button class="btn" style="display:none;" id="admin-btn" onclick="showPage('admin')">–ê–¥–º–∏–Ω–∫–∞</button>
  </div>
</div>

<!-- –ê–¥–º–∏–Ω–∫–∞ -->
<div id="admin" class="page">
  <div class="card">
    <p>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—á–µ—Ç–æ–≤</p>
    <button class="btn btn-red" onclick="showPage('earn')">–ù–∞–∑–∞–¥</button>
  </div>
</div>

<div class="nav">
  <button onclick="showPage('earn')">üí∞</button>
  <button onclick="showPage('profile')">üë§</button>
  <button onclick="showPage('info')">‚ÑπÔ∏è</button>
</div>

<script>
  if(userID == adminID){
    document.getElementById('admin-btn').style.display='block';
  }
</script>

</body>
</html>
