<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EASY MONEY</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
  import { getDatabase, ref, set, get, onValue, update, push } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyApcL3hN95djDhI-26L623jHHbzREswfQE",
    authDomain: "cash-1968a.firebaseapp.com",
    databaseURL: "https://cash-1968a-default-rtdb.firebaseio.com",
    projectId: "cash-1968a",
    storageBucket: "cash-1968a.appspot.com",
    messagingSenderId: "234016139024",
    appId: "1:234016139024:web:f11daa0328ff06173d2795"
  };
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  window.db = db;

  const tg = window.Telegram.WebApp;
  tg.expand();
  window.tg = tg;

  let uid = tg.initDataUnsafe?.user?.id || 0;
  let balance = 0;
  let energy = 1000;
  const userRef = ref(db, "users/" + uid);

  // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
  document.getElementById("uid").innerText = uid;
  document.getElementById("refLink").innerText = "https://t.me/DifferentEarningsBot?start=" + uid;
  document.getElementById("profilePic").src = tg.initDataUnsafe?.user?.photo_url || "";

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —é–∑–µ—Ä–∞
  get(userRef).then(snapshot => {
    if(!snapshot.exists()){
      set(userRef, {balance:0, energy:1000, referrals:0, doneTasks: []});
    }
  });

  // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
  onValue(userRef, snapshot => {
    const data = snapshot.val();
    if(data){
      balance = data.balance || 0;
      energy = data.energy || 0;
      document.getElementById("balance").innerText = balance.toFixed(2);
      document.getElementById("energy").innerText = energy;
    }
  });

  // --- –ó–ê–ì–†–£–ó–ö–ê –ó–ê–î–ê–ù–ò–ô ---
  const tasksRef = ref(db, "tasks");
  onValue(tasksRef, snapshot => {
    const taskList = document.getElementById("task-list");
    taskList.innerHTML = "";
    const data = snapshot.val();
    if(data) {
      Object.keys(data).forEach(key => {
        const task = data[key];
        const div = document.createElement("div");
        div.className = "card";
        div.style.marginBottom = "10px";
        div.innerHTML = `
          <strong>${task.name}</strong><br>
          <small>${task.desc}</small><br>
          <button class="btn" style="margin-top:8px" onclick="doTask('${key}', '${task.link}', ${task.price})">
            –í—ã–ø–æ–ª–Ω–∏—Ç—å (+${task.price}‚ÇΩ)
          </button>
        `;
        taskList.appendChild(div);
      });
    } else {
      taskList.innerText = "–ó–∞–¥–∞–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç.";
    }
  });

  // --- –ì–õ–û–ë–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ---
  window.showPage = function(id) {
    document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
    document.getElementById(id).classList.add("active");
  };

  window.nav = function(id, event) {
    document.querySelectorAll(".nav img").forEach(i => i.classList.remove("active"));
    showPage(id);
    if(event) event.target.classList.add("active");
  };

  window.tap = function() {
    if(energy <= 0) { alert("–≠–Ω–µ—Ä–≥–∏—è –Ω–∞ –Ω—É–ª–µ!"); return; }
    energy--;
    balance += 0.005;
    update(userRef, {balance, energy});
  };

  window.doTask = function(taskId, link, price) {
    tg.openLink(link);
    // –ü—Ä–æ—Å—Ç–µ–π—à–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –∑–∞–¥–µ—Ä–∂–∫—É (–º–æ–∂–Ω–æ —É—Å–ª–æ–∂–Ω–∏—Ç—å)
    setTimeout(() => {
        balance += price;
        update(userRef, {balance});
        alert(`–ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ! +${price}‚ÇΩ`);
    }, 5000);
  };

  window.copyRef = function() {
    navigator.clipboard.writeText(document.getElementById("refLink").innerText);
    alert("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!");
  };

  window.sendWithdraw = function() {
    const card = document.getElementById("card").value;
    const sum = Number(document.getElementById("sumWithdraw").value);
    if(sum < 100 || !card) { alert("–ú–∏–Ω–∏–º—É–º 100‚ÇΩ –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –∫–∞—Ä—Ç—É"); return; }
    if(sum > balance) { alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤"); return; }
    
    const wRef = push(ref(db, "withdrawals"));
    set(wRef, {uid, card, sum, status: "pending"});
    update(userRef, {balance: balance - sum});
    alert("–ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞!");
    showPage('profile');
  };

  window.addTask = function() {
    const name = document.getElementById("adminTaskName").value;
    const desc = document.getElementById("adminTaskDesc").value;
    const link = document.getElementById("adminTaskLink").value;
    const price = Number(document.getElementById("adminTaskPrice").value);
    if(!name || !price) return alert("–ó–∞–ø–æ–ª–Ω–∏ –ø–æ–ª—è");
    
    push(ref(db, "tasks"), {name, desc, link, price});
    alert("–î–æ–±–∞–≤–ª–µ–Ω–æ!");
  };

  // –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
  if(uid === 7020322752) {
    const adminContainer = document.getElementById("admin-btn-container");
    const btn = document.createElement("button");
    btn.className = "btn";
    btn.innerText = "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è–º–∏";
    btn.onclick = () => showPage('admin');
    adminContainer.appendChild(btn);
  }
</script>

<style>
*{box-sizing:border-box}
html,body{margin:0;height:100%;font-family:Arial,sans-serif;color:white;overflow:hidden}
body{background:url("https://i.postimg.cc/2jx4fT8X/Giga-Chat-40.jpg") center/cover no-repeat;}

.top{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;}
.title{font-size:22px;font-weight:900;padding:8px 14px;background:rgba(255,255,255,0.12);border:2px solid rgba(255,255,255,0.8);border-radius:16px;backdrop-filter:blur(6px);}
.balance{padding:10px 14px;background:rgba(0,0,0,0.55);border:2px solid rgba(255,255,255,0.8);border-radius:16px;cursor:pointer;}

.page{display:none;padding:20px;height:calc(100% - 150px);overflow-y:auto;}
.page.active{display:block}
.card{background:rgba(0,0,0,0.55);border:2px solid rgba(255,255,255,0.8);border-radius:22px;padding:20px;margin-bottom:20px;}
.btn{width:100%;padding:16px;margin-top:14px;font-size:16px;font-weight:600;color:white;background:rgba(255,255,255,0.1);border:2px solid rgba(255,255,255,0.8);border-radius:18px;cursor:pointer;}
.btn-red{background:rgba(255,0,0,0.3);}
input{width:100%; padding:14px; margin-top:10px; border-radius:15px; border:1px solid white; background: rgba(0,0,0,0.3); color:white;}

.nav{position:fixed;bottom:0;width:100%;height:90px;background:rgba(0,0,0,0.8);display:flex;justify-content:space-around;align-items:center;}
.nav img{width:48px;height:48px;opacity:0.5;cursor:pointer;transition:0.3s}
.nav img.active{opacity:1;transform:scale(1.1)}

.click-img{width:220px;height:220px;margin:30px auto;display:block;border-radius:30px;border:4px solid white;box-shadow:0 0 20px rgba(255,255,255,0.3);transition:0.1s}
.click-img:active{transform:scale(0.9)}
.profile-pic{width:60px;height:60px;border-radius:50%;border:2px solid white;margin-bottom:10px;}
</style>
</head>
<body>

<div class="top">
  <div class="title">EASY MONEY</div>
  <div class="balance" onclick="showPage('withdraw')">
    –ë–∞–ª–∞–Ω—Å: <span id="balance">0.00</span>‚ÇΩ
  </div>
</div>

<div id="earn" class="page active">
  <div class="card">
    <button class="btn" onclick="showPage('referral')">üë´ –†–µ—Ñ–µ—Ä–∞–ª—ã</button>
    <button class="btn" onclick="showPage('tasks')">üìã –ó–∞–¥–∞–Ω–∏—è</button>
    <button class="btn" onclick="showPage('click')">üñ±Ô∏è –ö–ª–∏–∫–µ—Ä</button>
  </div>
</div>

<div id="referral" class="page">
  <div class="card">
    <h3>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞</h3>
    <p>–¢–≤–æ—è —Å—Å—ã–ª–∫–∞:</p>
    <p id="refLink" style="word-break:break-all; font-size:12px; opacity:0.8"></p>
    <button class="btn" onclick="copyRef()">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
    <button class="btn btn-red" onclick="showPage('earn')">–ù–∞–∑–∞–¥</button>
  </div>
</div>

<div id="tasks" class="page">
  <h3 style="margin-left:10px">–î–æ—Å—Ç—É–ø–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è</h3>
  <div id="task-list"></div>
  <button class="btn btn-red" onclick="showPage('earn')">–ù–∞–∑–∞–¥</button>
</div>

<div id="click" class="page">
  <div class="card" style="text-align:center">
    <p>–≠–Ω–µ—Ä–≥–∏—è: <span id="energy">1000</span>/1000</p>
    <img class="click-img" src="https://i.postimg.cc/cCspvTn2/Picsart-26-01-03-04-33-45-909.png" onclick="tap()">
    <p style="margin-top:20px">+0.005‚ÇΩ –∑–∞ –∫–ª–∏–∫</p>
    <button class="btn btn-red" onclick="showPage('earn')">–ù–∞–∑–∞–¥</button>
  </div>
</div>

<div id="profile" class="page">
  <div class="card" style="text-align:center">
    <img id="profilePic" class="profile-pic" src="">
    <h3>–ü—Ä–æ—Ñ–∏–ª—å</h3>
    <p>–í–∞—à ID: <span id="uid"></span></p>
    <button class="btn" onclick="showPage('withdraw')">–í—ã–≤–µ—Å—Ç–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞</button>
  </div>
</div>

<div id="withdraw" class="page">
  <div class="card">
    <h3>–í—ã–≤–æ–¥ –¥–µ–Ω–µ–≥</h3>
    <input type="text" id="card" placeholder="–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã –∏–ª–∏ –°–ë–ü">
    <input type="number" id="sumWithdraw" placeholder="–°—É–º–º–∞ (–æ—Ç 100‚ÇΩ)">
    <button class="btn" onclick="sendWithdraw()">–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É</button>
    <button class="btn btn-red" onclick="showPage('profile')">–ù–∞–∑–∞–¥</button>
  </div>
</div>

<div id="info" class="page">
  <div class="card">
    <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
    <button class="btn" onclick="tg.openTelegramLink('https://t.me/news')">üì¢ –ö–∞–Ω–∞–ª —Å –Ω–æ–≤–æ—Å—Ç—è–º–∏</button>
    <button class="btn" onclick="tg.openTelegramLink('https://t.me/sup')">üí¨ –¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞</button>
    <div id="admin-btn-container"></div>
  </div>
</div>

<div id="admin" class="page">
  <div class="card">
    <h3>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h3>
    <input id="adminTaskName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è">
    <input id="adminTaskDesc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ">
    <input id="adminTaskLink" placeholder="–°—Å—ã–ª–∫–∞ (https://...)">
    <input id="adminTaskPrice" type="number" placeholder="–ù–∞–≥—Ä–∞–¥–∞ (‚ÇΩ)">
    <button class="btn" onclick="addTask()">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
    <button class="btn btn-red" onclick="showPage('info')">–ù–∞–∑–∞–¥</button>
  </div>
</div>

<div class="nav">
  <img src="https://i.postimg.cc/9MfvXtnQ/Picsart-26-01-03-07-41-15-897.png" onclick="nav('earn', event)" class="active">
  <img src="https://i.postimg.cc/jdGK89kw/Picsart-26-01-03-07-38-38-882.png" onclick="nav('profile', event)">
  <img src="https://i.postimg.cc/9fBhQfXL/Picsart-26-01-03-07-38-01-962.png" onclick="nav('info', event)">
</div>

</body>
</html>
