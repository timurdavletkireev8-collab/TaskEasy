<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Dog Money üê∂</title>
<style>
:root { --gold: linear-gradient(135deg,#ffcc00,#ff9f00);}
*{
    box-sizing:border-box;
    font-family:'Segoe UI',sans-serif;
    /* –£–±–∏—Ä–∞–µ–º —Å–∏–Ω–µ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ */
    -webkit-tap-highlight-color: transparent;
    user-select: none;
}
html,body{margin:0;padding:0;height:100%;background:radial-gradient(circle at top,#fff2d6,#ffd28a);overflow:hidden;}
header{text-align:center;padding:20px 15px; animation: fadeInDown 0.8s ease;}
.header-img{width:100%;max-width:340px;border-radius:22px;box-shadow:0 14px 35px rgba(0,0,0,0.3);}
.small{font-size:14px;opacity:0.7;margin-top:8px;}

.container{padding:15px;padding-bottom:120px; height: 100vh; overflow-y: auto;}

/* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ */
@keyframes cardIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.card{
    background:#fff;
    border-radius:22px;
    padding:18px;
    margin-bottom:16px;
    box-shadow:0 15px 35px rgba(0,0,0,0.12);
    animation: cardIn 0.5s ease backwards;
}

.btn{
    width:100%;
    padding:14px;
    border:none;
    border-radius:18px;
    font-size:16px;
    font-weight:600;
    cursor:pointer;
    background:var(--gold);
    box-shadow:0 8px 20px rgba(255,170,0,0.4);
    transition: transform 0.1s;
}
.btn:active{transform:scale(0.96);}

.section{display:none;}
.section.active{display:block;}

nav{position:fixed;bottom:12px;left:12px;right:12px;height:64px;background:rgba(255,255,255,0.95);backdrop-filter:blur(12px);border-radius:22px;display:flex;padding:6px;z-index:999;box-shadow:0 10px 30px rgba(0,0,0,0.25);}
nav button{flex:1;border:none;background:none;border-radius:16px;font-size:13px;font-weight:600;cursor:pointer; transition: 0.3s;}
nav button.active{background:var(--gold);box-shadow:0 6px 18px rgba(255,170,0,0.5);}

/* –ê–Ω–∏–º–∞—Ü–∏—è –∫–æ—Å—Ç–æ—á–µ–∫ */
.bone{
    position:fixed;
    font-size:24px;
    pointer-events:none;
    z-index:1000;
    animation: boneFly 1s cubic-bezier(0.12, 0.85, 0.5, 1) forwards;
}
@keyframes boneFly{
    0%{opacity:1; transform: translate(0,0) rotate(0deg) scale(1);}
    100%{opacity:0; transform: translate(var(--tx), var(--ty)) rotate(var(--tr)) scale(1.5);}
}

.profile-photo{width:64px;height:64px;border-radius:50%;object-fit:cover;margin-bottom:8px;}
#overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);display:none;z-index:10000;color:#fff;overflow:auto;padding:20px;}
#overlay .closeBtn{position:absolute;top:12px;right:12px;background:#ff9f00;color:#fff;border:none;padding:10px 16px;border-radius:12px;font-weight:600;}

#adminTable { width: 100%; border-collapse: collapse; margin-top: 15px; }
#adminTable td, #adminTable th { padding: 8px; border: 1px solid #333; font-size: 12px; }
#adminTable input { width: 50px; background: #333; color: #fff; border: none; padding: 4px; }
</style>
<script src="https://www.gstatic.com/firebasejs/10.2.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.2.0/firebase-firestore.js"></script>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>

<header>
  <img class="header-img" src="https://i.postimg.cc/nrrTt15j/Giga-Chat-36.jpg" alt="Dog Money">
  <div class="small">–ó–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π —Å —Å–æ–±–∞—á–∫–∞–º–∏ üê∂</div>
</header>

<div class="container">
  <div id="earn" class="section active">
    <div class="card" style="animation-delay: 0.1s;">
      <h2>üêæ –ö–ª–∏–∫–∏</h2>
      <p>–ñ–º–∏ –∏ –ø–æ–ª—É—á–∞–π –º–æ–Ω–µ—Ç—ã</p>
      <button class="btn actionBtn" data-type="click">–ö–ª–∏–∫–Ω—É—Ç—å üêï</button>
      <p id="clicks">–ö–ª–∏–∫–æ–≤: 0</p>
    </div>
    <div class="card" style="animation-delay: 0.2s;">
      <h2>üìã –ó–∞–¥–∞–Ω–∏—è</h2>
      <p>–í—ã–ø–æ–ª–Ω—è–π –∑–∞–¥–∞–Ω–∏—è –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π</p>
      <button class="btn actionBtn" data-type="tasks">–ü–µ—Ä–µ–π—Ç–∏ –∫ –∑–∞–¥–∞–Ω–∏—è–º</button>
    </div>
    <div class="card" style="animation-delay: 0.3s;">
      <h2>ü§ù –†–µ—Ñ–µ—Ä–∞–ª—ã</h2>
      <button class="btn actionBtn" data-type="referrals">–ü–µ—Ä–µ–π—Ç–∏</button>
    </div>
  </div>

  <div id="profile" class="section">
    <div class="card">
      <img src="" alt="–§–æ—Ç–æ" class="profile-photo" id="profilePhoto">
      <h2 id="profileUsername">‚Äî</h2>
      <p>ID: <span id="profileId">‚Äî</span></p>
      <p>–ë–∞–ª–∞–Ω—Å: <b id="profileBalance">0 ü™ô</b></p>
      <p>–ö–ª–∏–∫–∏: <span id="profileClicks">0</span></p>
    </div>
  </div>

  <div id="info" class="section">
    <div class="card">
      <h2>üì∞ –ù–æ–≤–æ—Å—Ç–∏</h2>
      <button class="btn">–ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞–Ω–∞–ª</button>
    </div>
    <div class="card" id="adminCard">
      <h2>üõ° –ê–¥–º–∏–Ω–∫–∞</h2>
      <button class="btn" id="openAdmin">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</button>
    </div>
    <div class="card">
      <h2>üõ† –ü–æ–¥–¥–µ—Ä–∂–∫–∞</h2>
      <p><b>@support_dogmoney</b></p>
    </div>
  </div>
</div>

<nav>
  <button id="btn-earn" class="active" onclick="openSection('earn')">üí∞ –ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å</button>
  <button id="btn-profile" onclick="openSection('profile')">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button>
  <button id="btn-info" onclick="openSection('info')">‚ÑπÔ∏è –ò–Ω—Ñ–æ</button>
</nav>

<div id="overlay">
  <button class="closeBtn" onclick="document.getElementById('overlay').style.display='none'">–ó–∞–∫—Ä—ã—Ç—å</button>
  <div id="overlayContent"></div>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.ready();

// Firebase
const firebaseConfig = {
    apiKey: "AIzaSyDeY43dAjpJ2NxHneG4W66veHNBiQ5jhfA",
    authDomain: "dogsmoney.firebaseapp.com",
    projectId: "dogsmoney",
    storageBucket: "dogsmoney.firebasestorage.app",
    messagingSenderId: "339745413806",
    appId: "1:339745413806:web:08f8fdd856ee92a3002b3f"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let clicks = 0, balance = 0, userRef, userId = 0;

function waitForUserData(callback){
    let tries = 0;
    const interval = setInterval(()=>{
        if(tg.initDataUnsafe?.user){ clearInterval(interval); callback(tg.initDataUnsafe.user); }
        else if(tries>20){ clearInterval(interval); callback({id: 12345, username: 'Guest'}); }
        tries++;
    },100);
}

waitForUserData(user=>{
    userId = user.id;
    document.getElementById("profileUsername").innerText = "@" + (user.username || "user");
    document.getElementById("profileId").innerText = userId;
    if(user.photo_url) document.getElementById("profilePhoto").src = user.photo_url;

    userRef = db.collection("users").doc(String(userId));
    userRef.get().then(docSnap=>{
        if(!docSnap.exists) userRef.set({username: user.username||"user", balance:0, clicks:0});
        else {
            const data = docSnap.data();
            clicks = data.clicks || 0; balance = data.balance || 0;
            updateUI();
        }
    });
});

function updateUI() {
    document.getElementById("profileBalance").innerText = balance + " ü™ô";
    document.getElementById("profileClicks").innerText = clicks;
    document.getElementById("clicks").innerText = "–ö–ª–∏–∫–æ–≤: " + clicks;
}

// –≠—Ñ—Ñ–µ–∫—Ç –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–æ—Å—Ç–æ—á–µ–∫
function burstBones(x, y) {
    for(let i=0; i<5; i++) {
        const bone = document.createElement("div");
        bone.className = "bone";
        bone.innerText = "ü¶¥";
        bone.style.left = x + "px";
        bone.style.top = y + "px";
        
        // –†–∞–Ω–¥–æ–º–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–ª–µ—Ç–∞
        const tx = (Math.random() - 0.5) * 200;
        const ty = (Math.random() - 0.5) * 200 - 100;
        const tr = Math.random() * 360;
        
        bone.style.setProperty('--tx', `${tx}px`);
        bone.style.setProperty('--ty', `${ty}px`);
        bone.style.setProperty('--tr', `${tr}deg`);
        
        document.body.appendChild(bone);
        setTimeout(() => bone.remove(), 1000);
    }
}

document.addEventListener("mousedown", e => burstBones(e.clientX, e.clientY));
document.addEventListener("touchstart", e => burstBones(e.touches[0].clientX, e.touches[0].clientY));

// –ù–∞–≤–∏–≥–∞—Ü–∏—è
function openSection(id){
    document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
    document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    document.getElementById("btn-"+id).classList.add("active");
    tg.HapticFeedback.impactOccurred("light");
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫ –∏ –ê–¥–º–∏–Ω–∫–∞
document.querySelectorAll(".actionBtn").forEach(btn=>{
    btn.addEventListener("click", () => {
        const type = btn.dataset.type;
        const overlay = document.getElementById("overlay");
        const content = document.getElementById("overlayContent");
        overlay.style.display="block";
        
        if(type === "click") {
            content.innerHTML = `<h2>üêæ –ö–ª–∏–∫–µ—Ä</h2><button class="btn" id="overlayClick">–ñ–ê–¢–¨! üêï</button><p id="oc">${clicks}</p>`;
            document.getElementById("overlayClick").onclick = () => {
                clicks++; updateUI(); 
                document.getElementById("oc").innerText = clicks;
                userRef.update({clicks});
                tg.HapticFeedback.impactOccurred("medium");
            };
        } else {
            content.innerHTML = `<h2>–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</h2>`;
        }
    });
});

document.getElementById("openAdmin").onclick = async () => {
    const overlay = document.getElementById("overlay");
    overlay.style.display="block";
    const content = document.getElementById("overlayContent");
    content.innerHTML = `<h2>üõ° –ê–¥–º–∏–Ω–∫–∞</h2><table id="adminTable"><tr><th>–ù–∏–∫</th><th>ü™ô</th><th>üêæ</th><th></th></tr></table>`;
    const users = await db.collection("users").get();
    const table = document.getElementById("adminTable");
    users.forEach(doc => {
        const data = doc.data();
        const row = table.insertRow();
        row.insertCell(0).innerText = data.username || "???";
        const bIn = document.createElement("input"); bIn.value = data.balance || 0; row.insertCell(1).appendChild(bIn);
        const cIn = document.createElement("input"); cIn.value = data.clicks || 0; row.insertCell(2).appendChild(cIn);
        const sB = document.createElement("button"); sB.innerText = "üíæ"; sB.onclick = () => {
            db.collection("users").doc(doc.id).update({balance: parseInt(bIn.value), clicks: parseInt(cIn.value)});
            alert("–û–∫!");
        }; row.insertCell(3).appendChild(sB);
    });
};
</script>
</body>
</html>
