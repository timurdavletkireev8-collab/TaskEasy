<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EASY MONEY - PRO</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
  import { getDatabase, ref, set, get, onValue, update, push, remove } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyApcL3hN95djDhI-26L623jHHbzREswfQE",
    authDomain: "cash-1968a.firebaseapp.com",
    databaseURL: "https://cash-1968a-default-rtdb.firebaseio.com",
    projectId: "cash-1968a",
    storageBucket: "cash-1968a.appspot.com",
    messagingSenderId: "234016139024",
    appId: "1:234016139024:web:f11daa0328ff06173d2795"
  };
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  window.db = db;

  const tg = window.Telegram.WebApp;
  tg.expand();
  window.tg = tg;

  let uid = tg.initDataUnsafe?.user?.id || 0;
  let balance = 0;
  let energy = 1000;
  const adminID = 7020322752;

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  const userRef = ref(db, "users/" + uid);
  onValue(userRef, s => {
    const d = s.val();
    if(d) {
      balance = d.balance || 0;
      energy = d.energy || 0;
      document.getElementById("balance").innerText = balance.toFixed(2);
      document.getElementById("energy").innerText = energy;
    } else {
      set(userRef, {balance:0, energy:1000, uid: uid});
    }
  });

  // --- –°–ü–ò–°–û–ö –ó–ê–î–ê–ù–ò–ô ---
  onValue(ref(db, "tasks"), s => {
    const list = document.getElementById("task-list");
    list.innerHTML = "";
    if(s.exists()) {
      s.forEach(child => {
        const t = child.val();
        const div = document.createElement("div");
        div.className = "card task-item";
        div.innerHTML = `<span>${t.name}</span> <b>${t.price}‚ÇΩ</b>`;
        div.onclick = () => openTaskView(child.key, t);
        list.appendChild(div);
      });
    }
  });

  window.openTaskView = function(id, task) {
    document.getElementById("t-title").innerText = task.name;
    document.getElementById("t-desc").innerText = task.desc;
    document.getElementById("t-price").innerText = task.price;
    document.getElementById("t-link-btn").onclick = () => tg.openLink(task.link);
    document.getElementById("t-send-btn").onclick = () => sendReport(id, task);
    showPage('task-view');
  };

  window.sendReport = function(taskId, task) {
    const info = document.getElementById("t-report-input").value;
    if(!info) return alert("–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—á–µ—Ç–∞!");
    push(ref(db, "reports"), {
        uid, taskId, taskName: task.name, info, price: task.price, status: "pending"
    });
    logAction(`–û—Ç–ø—Ä–∞–≤–∏–ª –æ—Ç—á–µ—Ç –ø–æ: ${task.name}`);
    alert("–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É!");
    showPage('tasks');
  };

  // --- –ê–î–ú–ò–ù–ö–ê: –ü–†–û–í–ï–†–ö–ê ---
  if(uid === adminID) {
    // –û—Ç—á–µ—Ç—ã
    onValue(ref(db, "reports"), s => {
      const cont = document.getElementById("admin-reports-list");
      cont.innerHTML = "";
      s.forEach(child => {
        const r = child.val();
        if(r.status === "pending") {
          const div = document.createElement("div");
          div.className = "card";
          div.innerHTML = `
            <small>–Æ–∑–µ—Ä: ${r.uid}</small><br><b>${r.taskName}</b><br>
            <p>–û—Ç—á–µ—Ç: ${r.info}</p>
            <button class="btn" style="background:green" onclick="approveReport('${child.key}')">–û–¥–æ–±—Ä–∏—Ç—å</button>
            <button class="btn btn-red" onclick="rejectReport('${child.key}')">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
          `;
          cont.appendChild(div);
        }
      });
    });

    // –í—ã–≤–æ–¥—ã
    onValue(ref(db, "withdrawals"), s => {
      const cont = document.getElementById("admin-withdraw-list");
      cont.innerHTML = "";
      s.forEach(child => {
        const w = child.val();
        if(w.status === "pending") {
          const div = document.createElement("div");
          div.className = "card";
          div.innerHTML = `
            –ö–∞—Ä—Ç–∞: ${w.card}<br>–°—É–º–º–∞: ${w.sum}‚ÇΩ<br>
            <button class="btn" style="background:green" onclick="approveWithdraw('${child.key}', ${w.uid}, ${w.sum})">–í—ã–ø–ª–∞—á–µ–Ω–æ</button>
            <button class="btn btn-red" onclick="rejectWithdraw('${child.key}', ${w.uid}, ${w.sum})">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
          `;
          cont.appendChild(div);
        }
      });
    });

    // –õ–æ–≥–∏
    onValue(ref(db, "logs"), s => {
      const cont = document.getElementById("admin-logs-list");
      cont.innerHTML = "";
      const logs = [];
      s.forEach(c => { logs.push(c.val()); });
      logs.reverse().slice(0, 50).forEach(l => {
        const div = document.createElement("div");
        div.style.fontSize = "12px";
        div.style.borderBottom = "1px solid #444";
        div.innerText = `[${l.time}] ID${l.uid}: ${l.msg}`;
        cont.appendChild(div);
      });
    });
  }

  // --- –§–£–ù–ö–¶–ò–ò –ú–û–î–ï–†–ê–¶–ò–ò ---
  window.approveReport = function(id) {
    get(ref(db, `reports/${id}`)).then(s => {
        const r = s.val();
        const uRef = ref(db, `users/${r.uid}`);
        get(uRef).then(us => {
            update(uRef, { balance: (us.val().balance || 0) + r.price });
            update(ref(db, `reports/${id}`), { status: "approved" });
            logAction(`–û–î–û–ë–†–ò–õ –∑–∞–¥–∞–Ω–∏–µ —é–∑–µ—Ä—É ${r.uid}`, true);
        });
    });
  };

  window.rejectReport = function(id) {
    update(ref(db, `reports/${id}`), { status: "rejected" });
    logAction(`–û–¢–ö–õ–û–ù–ò–õ –∑–∞–¥–∞–Ω–∏–µ —é–∑–µ—Ä—É`, true);
  };

  window.approveWithdraw = function(id, user_id, sum) {
    update(ref(db, `withdrawals/${id}`), { status: "completed" });
    logAction(`–í–´–ü–õ–ê–¢–ò–õ ${sum}‚ÇΩ —é–∑–µ—Ä—É ${user_id}`, true);
  };

  window.rejectWithdraw = function(id, user_id, sum) {
    const uRef = ref(db, `users/${user_id}`);
    get(uRef).then(us => {
        update(uRef, { balance: (us.val().balance || 0) + sum });
        update(ref(db, `withdrawals/${id}`), { status: "rejected" });
        logAction(`–û–¢–ö–õ–û–ù–ò–õ –≤—ã–≤–æ–¥ —é–∑–µ—Ä—É ${user_id}`, true);
    });
  };

  window.logAction = function(msg, isAdmin = false) {
    push(ref(db, "logs"), {
        uid: uid,
        msg: msg,
        time: new Date().toLocaleTimeString(),
        isAdmin: isAdmin
    });
  };

  window.showPage = function(id) {
    document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
    document.getElementById(id).classList.add("active");
  };

  window.nav = function(id, event) {
    document.querySelectorAll(".nav img").forEach(i => i.classList.remove("active"));
    showPage(id);
    if(event) event.currentTarget.classList.add("active");
  };

  window.tap = function() {
    if(energy <= 0) return;
    energy--;
    balance += 0.005;
    update(userRef, {balance, energy});
  };

  window.sendWithdraw = function() {
    const card = document.getElementById("card").value;
    const sum = Number(document.getElementById("sumWithdraw").value);
    if(sum < 100 || !card || sum > balance) return alert("–û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –±–∞–ª–∞–Ω—Å–∞");
    update(userRef, {balance: balance - sum});
    push(ref(db, "withdrawals"), {uid, card, sum, status: "pending"});
    logAction(`–ó–∞–ø—Ä–æ—Å –Ω–∞ –≤—ã–≤–æ–¥ ${sum}‚ÇΩ`);
    showPage('profile');
  };

  window.addTask = function() {
    const name = document.getElementById("adminTaskName").value;
    const desc = document.getElementById("adminTaskDesc").value;
    const link = document.getElementById("adminTaskLink").value;
    const price = Number(document.getElementById("adminTaskPrice").value);
    push(ref(db, "tasks"), {name, desc, link, price});
    alert("–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ");
  };

</script>

<style>
*{box-sizing:border-box}
body{margin:0;height:100vh;font-family:sans-serif;color:white;background:url("https://i.postimg.cc/2jx4fT8X/Giga-Chat-40.jpg") center/cover no-repeat;overflow:hidden;}
.top{display:flex;justify-content:space-between;padding:15px;background:rgba(0,0,0,0.3)}
.page{display:none;padding:15px;height:calc(100vh - 150px);overflow-y:auto;}
.active{display:block}
.card{background:rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.4);border-radius:15px;padding:15px;margin-bottom:10px;}
.btn{width:100%;padding:12px;margin-top:10px;border-radius:12px;border:none;background:white;color:black;font-weight:bold;cursor:pointer;}
.btn-red{background:rgba(255,0,0,0.4);color:white;}
.nav{position:fixed;bottom:0;width:100%;height:80px;display:flex;justify-content:space-around;background:rgba(0,0,0,0.8);align-items:center;}
.nav img{width:40px;opacity:0.5;}
.nav img.active{opacity:1;transform:scale(1.2)}
.task-item{display:flex;justify-content:space-between;align-items:center;cursor:pointer;}
input,textarea{width:100%;padding:10px;border-radius:10px;border:none;margin-top:10px;background:rgba(255,255,255,0.1);color:white;}
</style>
</head>
<body>

<div class="top">
  <div style="font-weight:900">EASY MONEY</div>
  <div onclick="showPage('withdraw')">üí∞ <span id="balance">0.00</span>‚ÇΩ</div>
</div>

<div id="tasks" class="page active">
  <h3>üìã –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞–Ω–∏–π</h3>
  <div id="task-list"></div>
</div>

<div id="task-view" class="page">
  <div class="card">
    <h2 id="t-title"></h2>
    <p id="t-desc"></p>
    <p>–ù–∞–≥—Ä–∞–¥–∞: <b id="t-price"></b>‚ÇΩ</p>
    <button class="btn" id="t-link-btn" style="background:#0088cc; color:white">–ü–µ—Ä–µ–π—Ç–∏ –ø–æ —Å—Å—ã–ª–∫–µ</button>
    <textarea id="t-report-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –æ—Ç—á–µ—Ç–∞..."></textarea>
    <button class="btn" id="t-send-btn" style="background:#28a745; color:white">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç</button>
    <button class="btn btn-red" onclick="showPage('tasks')">–û—Ç–º–µ–Ω–∞</button>
  </div>
</div>

<div id="click" class="page">
    <div class="card" style="text-align:center">
        <p>–≠–Ω–µ—Ä–≥–∏—è: <span id="energy">1000</span></p>
        <img src="https://i.postimg.cc/cCspvTn2/Picsart-26-01-03-04-33-45-909.png" style="width:200px" onclick="tap()">
        <button class="btn btn-red" onclick="showPage('earn')">–ù–∞–∑–∞–¥</button>
    </div>
</div>

<div id="profile" class="page">
    <div class="card">
        <img id="profilePic" src="" style="width:60px; border-radius:50%">
        <h3>ID: <span id="uid"></span></h3>
        <button class="btn" onclick="showPage('withdraw')">–í—ã–≤–æ–¥ –¥–µ–Ω–µ–≥</button>
    </div>
</div>

<div id="withdraw" class="page">
    <div class="card">
        <h3>–í—ã–≤–æ–¥ (–æ—Ç 100‚ÇΩ)</h3>
        <input id="card" placeholder="–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã">
        <input id="sumWithdraw" type="number" placeholder="–°—É–º–º–∞">
        <button class="btn" onclick="sendWithdraw()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        <button class="btn btn-red" onclick="showPage('profile')">–ù–∞–∑–∞–¥</button>
    </div>
</div>

<div id="info" class="page">
    <div class="card">
        <button class="btn" onclick="tg.openTelegramLink('https://t.me/news')">–ù–æ–≤–æ—Å—Ç–∏</button>
        <div id="admin-btn-container">
            <button class="btn" onclick="showPage('admin-panel')" id="adm-main-btn" style="display:none">–ê–¥–º–∏–Ω–∫–∞</button>
        </div>
    </div>
</div>

<div id="admin-panel" class="page">
    <button class="btn" onclick="showPage('admin-add-task')">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ</button>
    <button class="btn" onclick="showPage('admin-reports')">üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–∞–Ω–∏–π</button>
    <button class="btn" onclick="showPage('admin-withdraws')">üí∏ –ó–∞—è–≤–∫–∏ –Ω–∞ –≤—ã–≤–æ–¥</button>
    <button class="btn" onclick="showPage('admin-logs')">üìú –õ–æ–≥–∏ –¥–µ–π—Å—Ç–≤–∏–π</button>
    <button class="btn btn-red" onclick="showPage('info')">–ù–∞–∑–∞–¥</button>
</div>

<div id="admin-add-task" class="page">
    <div class="card">
        <input id="adminTaskName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
        <textarea id="adminTaskDesc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ"></textarea>
        <input id="adminTaskLink" placeholder="–°—Å—ã–ª–∫–∞">
        <input id="adminTaskPrice" type="number" placeholder="–¶–µ–Ω–∞">
        <button class="btn" onclick="addTask()">–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ</button>
        <button class="btn btn-red" onclick="showPage('admin-panel')">–ù–∞–∑–∞–¥</button>
    </div>
</div>

<div id="admin-reports" class="page">
    <h3>–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—á–µ—Ç–æ–≤</h3>
    <div id="admin-reports-list"></div>
    <button class="btn btn-red" onclick="showPage('admin-panel')">–ù–∞–∑–∞–¥</button>
</div>

<div id="admin-withdraws" class="page">
    <h3>–ó–∞—è–≤–∫–∏ –Ω–∞ –≤—ã–≤–æ–¥</h3>
    <div id="admin-withdraw-list"></div>
    <button class="btn btn-red" onclick="showPage('admin-panel')">–ù–∞–∑–∞–¥</button>
</div>

<div id="admin-logs" class="page">
    <h3>–ò—Å—Ç–æ—Ä–∏—è –¥–µ–π—Å—Ç–≤–∏–π</h3>
    <div id="admin-logs-list" class="card" style="font-family: monospace;"></div>
    <button class="btn btn-red" onclick="showPage('admin-panel')">–ù–∞–∑–∞–¥</button>
</div>

<div class="nav">
  <img src="https://i.postimg.cc/9MfvXtnQ/Picsart-26-01-03-07-41-15-897.png" onclick="nav('tasks', event)" class="active">
  <img src="https://i.postimg.cc/9fBhQfXL/Picsart-26-01-03-07-38-01-962.png" onclick="nav('click', event)">
  <img src="https://i.postimg.cc/jdGK89kw/Picsart-26-01-03-07-38-38-882.png" onclick="nav('profile', event)">
  <img src="https://i.postimg.cc/9fBhQfXL/Picsart-26-01-03-07-38-01-962.png" onclick="nav('info', event)">
</div>

<script>
    // –ü–æ–∫–∞–∑ –∫–Ω–æ–ø–∫–∏ –∞–¥–º–∏–Ω–∞
    setTimeout(() => {
        if(window.tg.initDataUnsafe?.user?.id === 7020322752) {
            document.getElementById('adm-main-btn').style.display = 'block';
        }
    }, 1000);
</script>

</body>
</html>
