<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Dog Money üê∂</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
:root { --gold: linear-gradient(135deg,#ffcc00,#ff9f00);}
*{box-sizing:border-box;font-family:'Segoe UI',system-ui,sans-serif;}
html,body{margin:0;padding:0;height:100%;background:radial-gradient(circle at top,#fff2d6,#ffd28a);overflow-x:hidden;}
header{text-align:center;padding:20px 15px 10px;}
.header-img{width:100%;max-width:340px;border-radius:22px;box-shadow:0 14px 35px rgba(0,0,0,.3);}
.small{font-size:14px;opacity:.7;margin-top:8px;}
.container{padding:15px;padding-bottom:120px;}
.card{background:#fff;border-radius:22px;padding:18px;margin-bottom:16px;box-shadow:0 15px 35px rgba(0,0,0,.12);}
.btn{width:100%;padding:14px;border:none;border-radius:18px;font-size:16px;font-weight:600;background:var(--gold);}
.section{display:none;}
.section.active{display:block;}
nav{position:fixed;bottom:12px;left:12px;right:12px;height:64px;background:#fff;border-radius:22px;display:flex;padding:6px;}
nav button{flex:1;border:none;background:none;border-radius:16px;font-size:13px;font-weight:600;}
nav button.active{background:var(--gold);}
.profile-photo{width:64px;height:64px;border-radius:50%;object-fit:cover;margin-bottom:8px;}
.bone{position:fixed;font-size:28px;pointer-events:none;animation:boneFly 0.8s ease forwards;z-index:1000;}
@keyframes boneFly{0%{opacity:1;transform:translateY(0) scale(1);}100%{opacity:0;transform:translateY(-60px) scale(1.6);}}
</style>
</head>

<body>

<header>
  <img class="header-img" src="https://i.postimg.cc/nrrTt15j/Giga-Chat-36.jpg">
  <div class="small">–ó–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π —Å —Å–æ–±–∞—á–∫–∞–º–∏ üê∂</div>
</header>

<div class="container">

<!-- –ó–ê–†–ê–ë–û–¢–û–ö -->
<div id="earn" class="section active">
  <div class="card">
    <h2>üêæ –ö–ª–∏–∫–∏</h2>
    <p>–ñ–º–∏ –∏ –ø–æ–ª—É—á–∞–π –º–æ–Ω–µ—Ç—ã</p>
    <button class="btn" id="clickBtn">–ö–ª–∏–∫–Ω—É—Ç—å üêï</button>
    <p id="clicks">–ö–ª–∏–∫–æ–≤: 0</p>
  </div>
  <div class="card">
    <h2>üìã –ó–∞–¥–∞–Ω–∏—è</h2>
    <p>–í—ã–ø–æ–ª–Ω—è–π –∑–∞–¥–∞–Ω–∏—è –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π</p>
    <button class="btn" onclick="openSection('tasks')">–ü–µ—Ä–µ–π—Ç–∏ –∫ –∑–∞–¥–∞–Ω–∏—è–º</button>
  </div>
  <div class="card">
    <h2>ü§ù –†–µ—Ñ–µ—Ä–∞–ª—ã</h2>
    <p>–ü—Ä–∏–≥–ª–∞—à–∞–π –¥—Ä—É–∑–µ–π –∏ –ø–æ–ª—É—á–∞–π –±–æ–Ω—É—Å</p>
    <button class="btn" onclick="openSection('referrals')">–ü–µ—Ä–µ–π—Ç–∏ –∫ —Ä–µ—Ñ–µ—Ä–∞–ª–∞–º</button>
  </div>
</div>

<!-- –ó–ê–î–ê–ù–ò–Ø -->
<div id="tasks" class="section">
  <div class="card">
    <h2>–ó–∞–¥–∞–Ω–∏—è</h2>
    <p>–í—ã–ø–æ–ª–Ω—è–π –∑–∞–¥–∞–Ω–∏—è –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π –º–æ–Ω–µ—Ç—ã</p>
    <div id="taskList"></div>
  </div>
</div>

<!-- –†–ï–§–ï–†–ê–õ–´ -->
<div id="referrals" class="section">
  <div class="card">
    <h2>–ú–æ–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—ã</h2>
    <p>–ü—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã–µ –≤–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:</p>
    <div id="referralList"></div>
  </div>
</div>

<!-- –ü–†–û–§–ò–õ–¨ -->
<div id="profile" class="section">
  <div class="card">
    <img id="profilePhoto" class="profile-photo">
    <h2 id="profileUsername">‚Äî</h2>
    <p>ID: <span id="profileId">‚Äî</span></p>
    <p>–ë–∞–ª–∞–Ω—Å: <b id="profileBalance">0 ü™ô</b></p>
    <p>–ö–ª–∏–∫–∏: <span id="profileClicks">0</span></p>
  </div>
</div>

<!-- –ò–ù–§–û -->
<div id="info" class="section">
  <div class="card">
    <h2>üì∞ –ù–æ–≤–æ—Å—Ç–Ω–æ–π –∫–∞–Ω–∞–ª</h2>
    <p>–í—Å–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ –Ω–æ–≤–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞.</p>
    <button class="btn" onclick="tg.openTelegramLink('https://t.me/')">–ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞–Ω–∞–ª</button>
  </div>
  <div class="card">
    <h2>üõ† –ü–æ–¥–¥–µ—Ä–∂–∫–∞</h2>
    <p><b>@support_dogmoney</b></p>
  </div>

  <div class="card" id="adminCard" style="display:none;">
    <h2>üõ° –ê–¥–º–∏–Ω–∫–∞</h2>
    <p>–¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞</p>
    <button class="btn" id="openAdmin">–î–æ–±–∞–≤–∏—Ç—å/–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ</button>
  </div>

  <div class="card">
    <h2>üìò –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ</h2>
    <p><b>1.</b> –ü–µ—Ä–µ–π–¥–∏ –≤ ¬´–ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å¬ª</p>
    <p><b>2.</b> –ö–ª–∏–∫–∞–π, –≤—ã–ø–æ–ª–Ω—è–π –∑–∞–¥–∞–Ω–∏—è</p>
    <p><b>3.</b> –ó–æ–≤–∏ –¥—Ä—É–∑–µ–π</p>
  </div>
</div>

</div>

<nav>
  <button id="btn-earn" class="active" onclick="openSection('earn')">–ó–∞—Ä–∞–±–æ—Ç–∞—Ç—å</button>
  <button id="btn-profile" onclick="openSection('profile')">–ü—Ä–æ—Ñ–∏–ª—å</button>
  <button id="btn-info" onclick="openSection('info')">–ò–Ω—Ñ–æ</button>
</nav>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.2.0/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, getDocs, arrayUnion, increment } from "https://www.gstatic.com/firebasejs/10.2.0/firebase-firestore.js";

const app = initializeApp({
  apiKey: "AIzaSyDeY43dAjpJ2NxHneG4W66veHNBiQ5jhfA",
  authDomain: "dogsmoney.firebaseapp.com",
  projectId: "dogsmoney"
});
const db = getFirestore(app);

window.tg = Telegram.WebApp;
tg.ready();

const user = tg.initDataUnsafe.user;
const userId = user.id;
const start = tg.initDataUnsafe.start_param;

let data = {clicks:0,balance:0,referrals:[],completedTasks:[]};

const ref = doc(db,"users",String(userId));
const snap = await getDoc(ref);

if(!snap.exists()){
  await setDoc(ref,{
    username:user.username,
    photo:user.photo_url,
    clicks:0,
    balance:0,
    referrals:[],
    completedTasks:[]
  });

  if(start && start !== String(userId)){
    await updateDoc(doc(db,"users",start),{
      referrals: arrayUnion(userId),
      balance: increment(10)
    });
  }
}else{
  data = snap.data();
}

render();

document.getElementById("clickBtn").onclick = async ()=>{
  data.clicks++;
  data.balance++;
  await updateDoc(ref,{clicks:data.clicks,balance:data.balance});
  render();
};

window.openSection = id=>{
  document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
};

async function render() {
  document.getElementById("clicks").innerText = "–ö–ª–∏–∫–æ–≤: " + data.clicks;
  document.getElementById("profileClicks").innerText = data.clicks;
  document.getElementById("profileBalance").innerText = data.balance + " ü™ô";
  document.getElementById("profileUsername").innerText = "@" + user.username;
  document.getElementById("profileId").innerText = userId;
  document.getElementById("profilePhoto").src = user.photo document.getElementById("profilePhoto").src = user.photo_url;

// –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
document.getElementById("referralList").innerHTML = data.referrals.map(id => `
  <div>–†–µ—Ñ–µ—Ä–∞–ª: @${id}</div>
`).join("");

// –ó–∞–¥–∞–Ω–∏—è
document.getElementById("taskList").innerHTML = data.completedTasks.length > 0 ? 
  data.completedTasks.map(task => `
    <div>–ó–∞–¥–∞–Ω–∏–µ: ${task} - –í—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
  `).join("") : `<div>–ù–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π</div>`;

document.getElementById("btn-earn").onclick = () => openSection('earn');
document.getElementById("btn-profile").onclick = () => openSection('profile');
document.getElementById("btn-info").onclick = () => openSection('info');

// –ö–æ—Å—Ç–æ—á–∫–∏
document.addEventListener("click", function(e) {
  const bone = document.createElement("div");
  bone.className = "bone";
  bone.innerText = "ü¶¥";
  bone.style.left = `${e.clientX - 12}px`;
  bone.style.top = `${e.clientY - 20}px`;
  document.body.appendChild(bone);
  setTimeout(() => bone.remove(), 800);
});

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∞–¥–º–∏–Ω–∫–∏
document.getElementById("openAdmin").addEventListener("click", async () => {
  const newTask = prompt("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è:");
  if (newTask) {
    data.completedTasks.push(newTask);
    await updateDoc(ref, { completedTasks: data.completedTasks });
    render();
  }
});

</script>
</body>
</html>
